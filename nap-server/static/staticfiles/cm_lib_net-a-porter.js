var CM_SITE_NAME="";var CM_SERVER="engine.cmmeglobal.com";var CM_CUST_VAR_ARRAY_NAME="";var CM_INCLUDE_CUST_ARRAY_IN_LOG_EVENT=true;var CM_ENABLE_FIREBUG_LOGGING=false;var CM_RESPONSE_CHECK_PERIOD_MS=10;var CM_RESPONSE_TIMEOUT_MS=5000;var CM_EVENT_DELIM="|";var CM_INCLUDE_PROFILE_ID=false;var CM_PROFILE_COOKIE_NAME="";var CM_PROFILE_ID_REGEX=CM_PROFILE_COOKIE_NAME+"=([^;]*)";var CM_USE_QS_VISISTORID_SESSIONID=false;var CM_QS_SITE_NAME_PARAM="sitenm";var CM_QS_CAPSULE_NAME_PARAM="capnm";var CM_QS_MATCHING_AREA_ID_PARAM="maid";var CM_QS_MATCHING_AREA_URL="murl";var CM_QS_TIME_PARAM="t";var CM_QS_VISITOR_ID_PARAM="visitorId";var CM_QS_SESSION_ID_PARAM="s";var CM_QS_TIME_ZONE_PARAM="tzo";var CM_QS_PAGE_VIEW_ID_PARAM="pgid";var CM_QS_IMPRESSION_ID="impid";var CM_QS_NAVIGATOR_PLUGINS="nplg";var CM_QS_WINDOW_HISTORY_LENGTH="hstl";var CM_QS_WINDOW_SCREEN_HEIGHT="scrh";var CM_QS_WINDOW_SCREEN_WIDTH="scrw";var CM_QS_WINDOW_PIXEL_DEPTH="scrd";var CM_QS_EXTERNAL_PARAMETERS="ep";var CM_QS_REFERRER="ref";var CM_QS_PAGE="pg";var CM_QS_ERROR="err";var CM_QS_PROFILE_ID="pfid";var CM_QS_PROFILE_ID_ERR="pfiderr";var CM_MAX_URL=1024;var CM_URI_CLICK_LOG_PATH="/v1/click";var CM_URI_REQUEST_LOG_PATH="/v1/request";var CM_URI_PAGE_VIEW_PATH="/v1/page-view";var CM_URI_VISITOR_EVENT_V1_PATH="/v1/visitor-event";var CM_URI_LOG_URL_REQUEST="/v1/log-url-request";var CM_URI_REWARD_EVENT_V1_PATH="/v1/secure-click-reward";var CM_COOKIE_NAME_CAPSULE_CLICK="click";var CM_AREA_NAME_WILDCARD="*";function cm_log(a){if(typeof console!=="undefined"&&CM_ENABLE_FIREBUG_LOGGING){if(typeof(a)==="string"||typeof(a)==="number"){console.log("[MatchingEngine] "+a)}else{console.log("[MatchingEngine] object:");console.log(a)}}}function cm_trim(a){if(!a){return""}if(a.length<=CM_MAX_URL){return a}return a.substr(0,CM_MAX_URL)}function cm_format_reward(b){var a=b.replace(/^\s+/,"");if(isNaN(a.charAt(0))){return a.substring(1,a.length)}return a}function cm_generate_page_view_id(){var c=[],e="0123456789ABCDEF";var b,a;for(b=0;b<36;b++){c[b]=Math.floor(Math.random()*16)}c[14]=4;c[19]=(c[19]&3)|8;for(a=0;a<36;a++){c[a]=e.charAt(c[a])}c[8]=c[13]=c[18]=c[23]="-";var d=c.join("");return d}function cm_encode(a){return encodeURIComponent(a)}function cm_is_ssl(){var a=(document.location.protocol==="https");return a}function cm_defined(a){return typeof(a)!=="undefined"}function cm_read_cookie(b){var e=b+"=";var a=document.cookie.split(";");var d;for(d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)===" "){f=f.substring(1,f.length)}if(f.indexOf(e)===0){return f.substring(e.length,f.length)}}return null}function cm_get_window_location(){var a=window.location.hostname;if(cm_defined(window.location.port)&window.location.port!==""){a=a+":"+window.location.port}return a}function cm_set_cookie(c,d,e){var a;if(e){var b=new Date();b.setTime(b.getTime()+(e*1000));a="; expires="+b.toGMTString()}else{a=""}document.cookie=c+"="+d+a+"; path=/"}function cm_delete_cookie(a){cm_set_cookie(a,"",-1)}function cm_assign_default_session_id(){var a=cm_read_cookie(CM_QS_SESSION_ID_PARAM);if(typeof a==="undefined"||null==a){a=cm_random_string(32)}cm_set_cookie(CM_QS_SESSION_ID_PARAM,a,1800);return a}function cm_assign_default_visitor_id(){var a=cm_read_cookie(CM_QS_VISITOR_ID_PARAM);if(typeof a==="undefined"||null==a){a=cm_random_string(32)}cm_set_cookie(CM_QS_VISITOR_ID_PARAM,a,86400);return a}function cm_random_string(e){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var a="";for(var b=0;b<e;b++){var c=Math.floor(Math.random()*d.length);a+=d.substring(c,c+1)}return a}var CM_PAGE_VIEW_ID=cm_generate_page_view_id();function cm_build_profile_id_query_string(){var a=document.cookie.match(CM_PROFILE_ID_REGEX);if(a===null){return CM_QS_PROFILE_ID_ERR+"=cookie"}else{if(a[1]===null||a[1].length===0){return CM_QS_PROFILE_ID_ERR+"=regex"}else{return CM_QS_PROFILE_ID+"="+a[1]}}}function cm_make_page_viewid_qs(){if(!CM_PAGE_VIEW_ID){CM_PAGE_VIEW_ID=generatePageViewId()}return CM_QS_PAGE_VIEW_ID_PARAM+"="+CM_PAGE_VIEW_ID}function cm_make_time_qs(){var a=new Date();return CM_QS_TIME_PARAM+"="+a.getTime()+"&"+CM_QS_TIME_ZONE_PARAM+"="+a.getTimezoneOffset()}function cm_cookie_params(){if(CM_USE_QS_VISISTORID_SESSIONID){if(typeof MatchingEngine.visitorIdGenerator==="undefined"){MatchingEngine.visitorIdGenerator=cm_assign_default_visitor_id}if(typeof MatchingEngine.sessionIdGenerator==="undefined"){MatchingEngine.sessionIdGenerator=cm_assign_default_session_id}return CM_QS_VISITOR_ID_PARAM+"="+MatchingEngine.visitorIdGenerator()+"&"+CM_QS_SESSION_ID_PARAM+"="+MatchingEngine.sessionIdGenerator()}return""}function cm_common_qs_params(){return CM_QS_SITE_NAME_PARAM+"="+cm_encode(CM_SITE_NAME)+"&"+cm_make_time_qs()+"&"+cm_make_page_viewid_qs()+"&"+cm_cookie_params()}function cm_get_cust_array(){var c=[];var b=[];var a;if(CM_CUST_VAR_ARRAY_NAME!==""&&typeof(window[CM_CUST_VAR_ARRAY_NAME])!=="undefined"){c=window[CM_CUST_VAR_ARRAY_NAME];for(a in c){if(c.hasOwnProperty(a)&&typeof(c[a])!=="function"){var d=c[a];if(d!==null&&(typeof d==="string"||typeof d==="number")){b[a]=d.toString().replace(/\|/g,",")}}}}return b}function cm_make_production_mode_global_qs_params(){var a="";var b;if(cm_defined(navigator.plugins)){a=a+"&"+CM_QS_NAVIGATOR_PLUGINS+"="+navigator.plugins.length}if(cm_defined(window.history)){a=a+"&"+CM_QS_WINDOW_HISTORY_LENGTH+"="+window.history.length}if(cm_defined(window.screen.height)){a=a+"&"+CM_QS_WINDOW_SCREEN_HEIGHT+"="+window.screen.height}if(cm_defined(window.screen.width)){a=a+"&"+CM_QS_WINDOW_SCREEN_WIDTH+"="+window.screen.width}if(cm_defined(window.screen.pixelDepth)){a=a+"&"+CM_QS_WINDOW_PIXEL_DEPTH+"="+window.screen.pixelDepth}if(cm_is_ssl()){a=a+"&"+CM_QS_PAGE+"="+cm_encode(cm_trim(document.location.href))}if(cm_defined(document.referrer)&&document.referrer){a=a+"&"+CM_QS_REFERRER+"="+cm_encode(document.referrer)}if(CM_INCLUDE_PROFILE_ID){b=cm_build_profile_id_query_string();a=a+"&"+b}return a}function cm_build_matching_area_identifiers_qs(c){var a=cm_common_qs_params();var b;for(b=0;b<c.length;b++){a=a+"&=[&"+CM_QS_MATCHING_AREA_ID_PARAM+"="+cm_encode(c[b])+"&=]"}a=a+"&"+CM_QS_MATCHING_AREA_URL+"="+cm_encode(document.URL);a=a+cm_make_production_mode_global_qs_params();return a}function cm_new_xmlhttprequest(){var a=false;if(window.XMLHttpRequest&&!(window.ActiveXObject)){try{a=new XMLHttpRequest()}catch(d){a=false}}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=false}}}}return a}function cm_ajax_log_request(a){var b=cm_new_xmlhttprequest();if(b){b.open("GET",a,false);b.send("");return true}else{return false}}function cm_ie_friendly_delay(){var a=0;var c=new Date().getTime();var b=c+150;while(new Date().getTime()<b){var d=document.getElementById(new Date().getTime());if(d!==null){a=a+1}}return a>0}function cm_image_log_click(a){cm_log("cm_image_log_click url="+a);var b=new Image();b.src=a;cm_ie_friendly_delay();return true}function cm_is_safari(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("safari/")!==-1&&a.indexOf("chrome")===-1){return true}else{return false}}function cm_is_chrome(){var a=navigator.userAgent.toLowerCase();return a.indexOf("chrome")!==-1}function cm_log_click(f,d,e){var a=cm_common_qs_params();a=a+"&"+CM_QS_CAPSULE_NAME_PARAM+"="+cm_encode(f);a=a+"&"+CM_QS_IMPRESSION_ID+"="+cm_encode(d);var c=CM_URI_CLICK_LOG_PATH;if(e){a=a+"&erw="+e;c=CM_URI_REWARD_EVENT_V1_PATH}var b=document.location.protocol+"//"+CM_SERVER+c+"?"+a;if(cm_is_safari()||cm_is_chrome()){cm_ajax_log_request(b)}else{cm_image_log_click(b)}return true}function cm_log_click_check(){var a=cm_read_cookie(CM_COOKIE_NAME_CAPSULE_CLICK);if(a!==null){var b=new Image();b.src=document.location.protocol+"//"+CM_SERVER+CM_URI_CLICK_LOG_PATH+"?"+a;cm_delete_cookie(CM_COOKIE_NAME_CAPSULE_CLICK)}}function cm_get_ie_ver(){var c=-1;if(navigator.appName==="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!==null){c=parseFloat(RegExp.$1)}}return c}function CMEngineCookie(a,b){this.name=a;if(typeof(b)!=="undefined"){this.parser=b}}function CMEngine(){this.areas=[];this.defaultCallback=function(){};this.cookiesToScrape=[]}CMEngine.prototype.push=function(d){try{if(d.length===0){cm_log("Error executing push. Invalid command in cm command array: "+d);cm_log(d);return}var f=d[0];cm_log("Executing push: "+f);switch(f){case"setup":var a=d[1].toString();if(d.length===2){this.setup(a)}else{this.setup(a,d[2].toString())}break;case"logEvent":var c=d[1].toString();if(d.length===2){this.logEvent(c)}else{this.logEventArray(c,d.slice(2))}break;case"setCustomerName":CM_SITE_NAME=d[1].toString();break;case"forceTimeout":CM_SERVER="unknown.cogmatchaddress.com";break;case"enableConsole":CM_ENABLE_FIREBUG_LOGGING=true;break;case"setTrackingArrayName":CM_CUST_VAR_ARRAY_NAME=d[1].toString();break;case"setServerHost":var b=d[1].toString();CM_SERVER=b;break;case"setTimeoutHandler":if(typeof(d[1])!=="function"){cm_log("Invalid timeout handler. Should be a function:"+d[1])}else{this.defaultCallback=d[1]}break;case"includeCookie":if(d.length===3&&typeof(d[2])==="function"){this.cookiesToScrape.push(new CMEngineCookie(d[1].toString(),d[2]))}else{this.cookiesToScrape.push(new CMEngineCookie(d[1].toString()))}break;case"setVisitorIdGenerator":if(typeof(d[1])!=="function"){cm_log("Invalid visitorId generator handler. Should be a function:"+d[1])}else{this.visitorIdGenerator=d[1]}break;case"setSessionIdGenerator":if(typeof(d[1])!=="function"){cm_log("Invalid sessionId generator handler. Should be a function:"+d[1])}else{this.sessionIdGenerator=d[1]}break;case"useQsVisitorIdSessionId":CM_USE_QS_VISISTORID_SESSIONID=new Boolean(d[1]);break;default:cm_log("Unknown command: "+f);break}}catch(g){cm_log(g)}};CMEngine.prototype.setRequestPath=function(a){return};CMEngine.prototype.setup=function(m,e){var g=cm_get_ie_ver();if(g===5){return}var l,h;h=m.split(",");this.serverTimeout=false;this.timestamp=new Date().getTime();if(typeof(this.areaNames)==="undefined"){this.areaNames=[]}for(l=0;l<h.length;l++){var c={};var k=h[l];c.name=k;c.content=null;c.displayed=false;this.areas[k]=c;this.areaNames.push(k)}var f=cm_build_matching_area_identifiers_qs(h);var a=document.location.protocol+"//"+CM_SERVER+"/v1/request?"+f;var n="";if(cm_defined(e)&&e.length>0){n=n+e}var j=this._buildCustVarQs();if(j!==""){if(n.length>0){n=n+"&"}n=n+j}if(n.length>0){a=a+"&"+CM_QS_EXTERNAL_PARAMETERS+"="+cm_encode(n)}var b=document.createElement("script");b.setAttribute("id","cm_server_request");b.setAttribute("src",a);var d=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);setTimeout(function(){MatchingEngine._responseChecker()},CM_RESPONSE_CHECK_PERIOD_MS)};CMEngine.prototype.logEvent=function(e){var d;var c;if(arguments.length===0){return}var b=e;for(d=1;d<arguments.length;d++){b=b+CM_EVENT_DELIM+arguments[d]}if(CM_INCLUDE_CUST_ARRAY_IN_LOG_EVENT&&CM_CUST_VAR_ARRAY_NAME!==""&&typeof(window[CM_CUST_VAR_ARRAY_NAME])!=="undefined"){var h=cm_get_cust_array();for(c in h){if(h.hasOwnProperty(c)&&typeof(h[c])!=="function"){var g=h[c];if(g!==null&&(typeof g==="string"||typeof g==="number")){b=b+CM_EVENT_DELIM+c+"="+g}}}}var a="event="+cm_encode(b)+"&"+cm_common_qs_params()+cm_make_production_mode_global_qs_params();var f=new Image();f.src=document.location.protocol+"//"+CM_SERVER+CM_URI_VISITOR_EVENT_V1_PATH+"?"+a};CMEngine.prototype.logEventArray=function(b,a){var e;var h;if(arguments.length===0){return}console.log(a);var j=b;for(e=0;e<a.length;e++){j=j+CM_EVENT_DELIM+a[e];console.log(e+":"+j)}if(CM_INCLUDE_CUST_ARRAY_IN_LOG_EVENT&&CM_CUST_VAR_ARRAY_NAME!==""&&typeof(window[CM_CUST_VAR_ARRAY_NAME])!=="undefined"){var f=cm_get_cust_array();for(h in f){if(f.hasOwnProperty(h)&&typeof(f[h])!=="function"){var c=f[h];if(c!==null&&(typeof c==="string"||typeof c==="number")){j=j+CM_EVENT_DELIM+h+"="+c}}}}var g="event="+cm_encode(j)+"&"+cm_common_qs_params()+cm_make_production_mode_global_qs_params();var d=new Image();d.src=document.location.protocol+"//"+CM_SERVER+CM_URI_VISITOR_EVENT_V1_PATH+"?"+g};CMEngine.prototype.logPageView=function(){this.push(["logEvent","pageView","url="+window.location])};CMEngine.prototype.logConversion=function(){var b=cm_read_cookie("cm_impid");var d=cm_read_cookie("cm_capsulename");var a;cm_log_click(d,b);if(arguments.length===0){return}var c=arguments[0];for(a=1;a<arguments.length;a++){c=c+CM_EVENT_DELIM+arguments[a]+"="+document.getElementById(arguments[a]).innerHTML}CMEngine.logEvent(c)};CMEngine.prototype.logReward=function(){var a=cm_read_cookie("cm_impid");var c=cm_read_cookie("cm_capsulename");var b=cm_format_reward(document.getElementById("reward").innerHTML);cm_log_click(c,a,b);return true};CMEngine.prototype.display=function(a){this._displayInternal(a)};CMEngine.prototype._arrayToQs=function(a){var b="";for(key in a){if(a.hasOwnProperty(key)){var c=a[key];if(c!==null&&(typeof c==="string"||typeof c==="number")){if(b.length>0){b=b+"&"}b=b+key+"="+c}}}return b};CMEngine.prototype._buildCookieVarQs=function(){var b,f,a,e,d="";for(b=0;b<this.cookiesToScrape.length;b++){f=this.cookiesToScrape[b].name;a=this.cookiesToScrape[b].parser;e=cm_read_cookie(f);if(e===null){continue}else{if(typeof(a)==="function"){var c=a(e);d=d+this._arrayToQs(c)}else{d=d+f+"="+e}}}return d};CMEngine.prototype._buildCustVarQs=function(){var b="";var c,a;if(CM_CUST_VAR_ARRAY_NAME!==""&&typeof(window[CM_CUST_VAR_ARRAY_NAME])!=="undefined"){c=window[CM_CUST_VAR_ARRAY_NAME];b=this._arrayToQs(c)}a=this._buildCookieVarQs();if(a!==""){if(b.length>0){b=b+"&"}b=b+a}return b};CMEngine.prototype._buildCustomerVariableQs=function(){var d=cm_get_cust_array();var a="";var b;for(b in d){if(d.hasOwnProperty(b)){var c=d[b];if(c!==null&&(typeof c==="string"||typeof c==="number")){if(a.length>0){a=a+"&"}a=a+b+"="+c}}}return cm_encode(a)};CMEngine.prototype._displayInternal=function(c){if(cm_get_ie_ver()===5){this._displayAreaDefault(c);return}var b=this.areas[c];if(cm_defined(b)){if(b.content!==null){var a=document.getElementById(c);if(a!==null){this._replaceWithScripts(a,b.content);b.displayed=true}}}};CMEngine.prototype._displayAll=function(){var b=true;var a;for(a=0;a<this.areaNames.length;a++){var d=this.areas[this.areaNames[a]];if(!d.displayed){if(d.content!==null){var c=document.getElementById(d.name);if(c!==null){this._replaceWithScripts(c,d.content);d.displayed=true}else{d.displayed=false;b=false}}else{d.displayed=false;b=false}}}return b};CMEngine.prototype._replaceWithScripts=function(b,g){if(g.indexOf("<script>")===0){g="<div style='display:none'>&nbsp;</div>"+g}b.innerHTML=g;var a=b.getElementsByTagName("script");if(a&&a.length>0){var h=a.length;var f;var e=[];for(f=h-1;f>=0;f--){var c=a[f];e[f]=a[f].text;c.parentNode.removeChild(c)}for(f=0;f<h;f++){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("language","JavaScript");d.text=e[f];b.appendChild(d)}}cm_log("Displayed content for area="+b.id)};CMEngine.prototype._responseChecker=function(){if(this.serverTimeout){return}var c=this._displayAll();var a=new Date().getTime()-this.timestamp;cm_log("Checking for response, timeElapsed="+a+"ms (Timeout after "+CM_RESPONSE_TIMEOUT_MS+")");var b=a>=CM_RESPONSE_TIMEOUT_MS;if(!c&&!b){setTimeout(function(){MatchingEngine._responseChecker()},CM_RESPONSE_CHECK_PERIOD_MS)}else{if(!c&&b){cm_log("timeout allDisplayed="+c);this._handleTimeout()}}};CMEngine.prototype._handleTimeout=function(){var a;cm_log("timeout");this.serverTimeout=true;for(a=0;a<this.areaNames.length;a++){var c=this.areaNames[a];var b=this.areas[c];if(!b.displayed){cm_log("No content recieved for areaName="+c+", showing default");this.areas[c].displayed=this._displayAreaDefault(c)}}this.defaultCallback()};CMEngine.prototype._displayAreaDefault=function(c){var a=document.getElementById(c+"_default");if(a!==null){var b=document.getElementById(c);if(b!==null){b.innerHTML=a.innerHTML;this.areas[c].displayed=true;cm_log("Displayed default for area="+c);return true}}return false};CMEngine.prototype._callback=function(c,b){cm_log("Received content from server for areaName="+c);var a=this.areas[c];if(cm_defined(a)){a.content=b;this._displayInternal(c)}};CMEngine.prototype._callback_display_default=function(b){var a;cm_log("Received display-default signal for areaName="+b);if(b!==CM_AREA_NAME_WILDCARD){this._displayAreaDefault(b)}else{for(a=0;a<this.areaNames.length;a++){if(!this.areas[this.areaNames[a]].displayed){this._displayAreaDefault(this.areaNames[a])}}}};function cm_callback_proxy(b,a){MatchingEngine._callback(b,a)}function cm_display_default(a){MatchingEngine._callback_display_default(a)}if(typeof(MatchingEngine)==="undefined"){var MatchingEngine=new CMEngine()}else{var _preLoadMatchingEngine=MatchingEngine;MatchingEngine=new CMEngine();(function(){var a;for(a=0;a<_preLoadMatchingEngine.length;a++){MatchingEngine.push(_preLoadMatchingEngine[a])}})()};