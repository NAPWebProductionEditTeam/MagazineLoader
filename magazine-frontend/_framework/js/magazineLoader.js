var magazineLoader=function(){magazineDebugLog({status:"loaded",namespace:"magazineLoader"});var DEFAULT_FRAMEWORK_PATH="/alfresco/webAssets/magazine/_framework/",BASE_LOCATION="/magazine",BASE_FLASH_LOCATION="/Content/flashMagazine#/",FIRST_ISSUE_NUMBER=166,PDF_LOCATION="/flash/magazine/";var jQueryMobileURI,issueDate,pageNumber,issueNumber,issueDevice,pageTitle,pageFeature,debugMode,channel,language,assetPath,cssAnimationEngine,jQueryAnimationEngine,javaScriptExtention,hashbangstatus,jsDownloadCache,dynamicSubSetting=false;function init(constructor){var pageNumber=constructor.pageNumber?constructor.pageNumber:0;var constructorDate=constructor.issueDate?constructor.issueDate:new Date;var issueNumber=constructor.issueNumber?constructor.issueNumber:1;var device=constructor.device?constructor.device:null;var title=constructor.title?constructor.title:"page "+pageNumber;var feature=constructor.feature?constructor.feature:null;var debug=constructor.debug?constructor.debug:false;var channel=constructor.channel?constructor.channel:"intl";var path=constructor.path?constructor.path:DEFAULT_FRAMEWORK_PATH;var language=constructor.language?constructor.language:"en";set_initialPage(pageNumber);set_IssueNumber(issueNumber);set_IssueDevice(device);set_PageTitle(title);set_PageFeature(feature);set_debugMode(debug);set_channel(channel);set_assetPath(path);set_IssueDate(constructorDate);set_language(language);if(get_language()!="en"){var monotypeDynamicFontEnabled=checkIfUserRequiresFontDynamicSubSetting(get_language());if(monotypeDynamicFontEnabled){try{magazineDebugLog({status:"debug",namespace:"magazineLoader",functionName:"init",msg:"Dynamic subsetting loaded for "+get_language(),lineNumber:(new Error).lineNumber});MonoTypeWebFonts.RefreshFonts();dynamicSubSettingEnabled(true)}catch(err){magazineDebugLog({status:"error",namespace:"magazineLoader",functionName:"init",msg:"Monotype dynamic subsetting JS is missing, fonts can't be loaded",lineNumber:(new Error).lineNumber});dynamicSubSettingEnabled(false)}}}checkUserImageExperience();if(navigator.userAgent.indexOf("iPad")!=-1){$("html, body").animate({scrollTop:$("#magazineHolder").offset().top},500)}if(debug){debugContentMode();set_javaScriptExtention(".js");jsDownloadCache=false}else{set_javaScriptExtention(".min.js");jsDownloadCache=true}checkForHashBangRequest();$("#magazineLoader").css({display:"block"});cssAnimationEngine="js/animationLibraries/CSS3-Engine";set_cssAnimationEngine(cssAnimationEngine);magazineDebugLog({status:"init",namespace:"magazineLoader",functionName:"init",msg:"set up magazine",lineNumber:(new Error).lineNumber,lineNumber:(new Error).lineNumber});$(document).ready(function(){magazineBuilder.createMagazine();if($("#contents").is(":visible")){var height=$("#contents").height()+32;height=height<624?624:height;$("#magazineHolder").height(height)}$("#magazineLoader").animate({bottom:"-=36px"},1e3,function(){$("#magazineLoader").css({display:"none"})})})}function checkIfUserRequiresFontDynamicSubSetting(language){switch(language){case"zh":return true;break;default:return false}}function checkUserImageExperience(){if(hasRetinaDisplay()){magazineDebugLog({status:"debug",namespace:"magazineLoader",functionName:"hasRetinaDisplay",msg:"User has retina display",lineNumber:(new Error).lineNumber});if(jQuery().updateImageSource){magazineDebugLog({status:"debug",namespace:"magazineLoader",functionName:"checkUserImageExperience",msg:"Replace images with @2x version",lineNumber:(new Error).lineNumber});$("#magazineHolder").updateImageSource({ajaxEnabled:true,ajaxSelector:"#magazinePages"})}}}function hasRetinaDisplay(){return"devicePixelRatio"in window&&window.devicePixelRatio>1}function checkForHashBangRequest(){var desiredContent=window.location.hash.substring(1),pageJump,desiredPage,desiredIssue,desiredURL;if(desiredContent){if(desiredContent.split("/").length<3){desiredIssue=desiredContent.split("/")[1];set_IssueNumber(desiredIssue);set_hashBangStatus(true);magazineRedirect(desiredIssue)}else{desiredIssue=desiredContent.split("/")[1];desiredPage=desiredContent.split("/")[2];set_hashBangStatus(true);magazineRedirect(desiredIssue,desiredPage)}}else{desiredIssue=get_IssueNumber();desiredPage=get_initialPage();set_hashBangStatus(false);magazineLoader.magazineDebugLog({status:"Load",namespace:"magazineLoader",functionName:"checkForHashBangRequest",msg:"no hash bang, load issue "+desiredIssue+" page "+desiredPage,lineNumber:(new Error).lineNumber})}}function magazineRedirect(issue,page){var desiredPage,desiredIssue,desiredURL,desiredFlashURL;if(page){desiredURL=BASE_LOCATION+"/"+issue+"/"+page;desiredFlashURL=BASE_FLASH_LOCATION+issue+"/"+page}else{desiredURL=BASE_LOCATION+"/"+issue;desiredFlashURL=BASE_FLASH_LOCATION+issue+"/contents"}if(issue>=FIRST_ISSUE_NUMBER){magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineLoader",functionName:"checkForHashBangRequest",msg:"connection via hash bang, redirect url to "+desiredURL,lineNumber:(new Error).lineNumber});window.location=desiredURL}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineLoader",functionName:"checkForHashBangRequest",msg:"Flash issues no longer available, redirect removed",lineNumber:(new Error).lineNumber})}}function loadJSDependencies(dependencies,setupMagazine){}function magazineFileLoader(fileURI,internalFile,namespace,functionName,callback){if(internalFile){if(get_assetPath()){fileURI=get_assetPath()+fileURI+get_javaScriptExtention()}}var fileDownload=$.getScript(fileURI);fileDownload.done(function(script,textStatus){magazineLoader.magazineDebugLog({status:"success",namespace:namespace,functionName:functionName,msg:"'"+fileURI+"'"+" has been downloaded",lineNumber:(new Error).lineNumber});var obj={status:"done",script:fileURI,textStatus:textStatus};callback(obj)});fileDownload.fail(function(jqxhr){magazineLoader.magazineDebugLog({status:"critical error",namespace:namespace,functionName:functionName,msg:"'"+fileURI+"'"+" has failed to download",lineNumber:(new Error).lineNumber});magazineDebugObj(jqxhr);var obj={status:"fail",script:fileURI,jqxhr:jqxhr};callback(obj)})}function magazineDebugLog(constructor){var status=constructor.status?constructor.status:"";var namespace=constructor.namespace?constructor.namespace:"";var functionName=constructor.functionName?constructor.functionName:"";var msg=constructor.msg?constructor.msg:"";var lineNumber=constructor.lineNumber?constructor.lineNumber:"";if(get_debugMode()){if(!functionName==""){functionName="."+functionName}if(status){status=status.toUpperCase()+" "}if(!lineNumber==""){lineNumber="(line "+lineNumber+")"}if(!msg==""){msg=": "+msg}if(console.log){console.log(status+namespace+functionName+lineNumber+msg)}}}function magazineDebugObj(obj){if(get_debugMode()){if(console.log){console.log(obj)}}}function debugContentMode(){$("#magazinePages li.page").each(function(){$(this).toggleClass("debug")})}function dynamicSubSettingEnabled(setStatus){if(!setStatus){return dynamicSubSetting}else{dynamicSubSetting=setStatus}}function doubleFigureDate(value){return(value<10?"0":"")+value}function stripPageID(pageSelector){if(pageIndex.search("li#page")>-1){var pageNumber=pageIndex.split("li#page")[1];return pageNumber}}function addPageID(pageNumber){if(pageNumber){var pageSelector="li#page"+pageNumber;return pageSelector}}function set_initialPage(setStatus){if(!setStatus){return pageNumber}else{switch(setStatus){case"contents":pageNumber=0;break;case"archive":pageNumber=parseInt(magazineBuilder.get_NumberOfPages());break;default:pageNumber=setStatus}}}function set_jQueryMobileVersion(setStatus){if(!setStatus){return jQueryMobileURI}else{jQueryMobileURI=setStatus}}function set_IssueDate(setStatus){if(!setStatus){return issueDate}else{issueDate=setStatus}}function set_IssueNumber(setStatus){if(!setStatus){return issueNumber}else{issueNumber=setStatus}}function set_IssueDevice(setStatus){if(!setStatus){return issueDevice}else{issueDevice=setStatus}}function set_PageTitle(setStatus){if(!setStatus){return pageTitle}else{pageTitle=setStatus}}function set_PageFeature(setStatus){if(!setStatus){return pageFeature}else{pageFeature=setStatus}}function set_debugMode(setStatus){if(!setStatus){return debugMode}else{debugMode=setStatus}}function set_channel(setStatus){if(!setStatus){return channel}else{channel=setStatus.toLowerCase()}}function set_language(setStatus){if(!setStatus){return language}else{language=setStatus.toLowerCase()}}function set_assetPath(setStatus){if(!setStatus){return assetPath}else{assetPath=setStatus}}function set_cssAnimationEngine(setStatus){if(!setStatus){return cssAnimationEngine}else{cssAnimationEngine=setStatus}}function set_jQueryAnimationEngine(setStatus){if(!setStatus){return jQueryAnimationEngine}else{jQueryAnimationEngine=setStatus}}function set_javaScriptExtention(setStatus){if(!setStatus){return javaScriptExtention}else{javaScriptExtention=setStatus}}function set_hashBangStatus(setStatus){if(!setStatus){return hashbangstatus}else{hashbangstatus=setStatus}}function get_jQueryMobileVersion(){var jQueryMobile=set_jQueryMobileVersion();return jQueryMobile}function get_initialPage(){var pageNumber=set_initialPage();return pageNumber}function get_IssueDate(){var collectIssueDate=set_IssueDate();var issueYear=collectIssueDate.getFullYear();var issueMonth=doubleFigureDate(collectIssueDate.getMonth()+1);var issueDay=doubleFigureDate(collectIssueDate.getDate());var issueDate=issueDay+issueMonth+issueYear;return issueDate}function get_IssueNumber(){var issueNumber=set_IssueNumber();return issueNumber}function get_IssueDevice(){var collectIssueDevice=set_IssueDevice();return collectIssueDevice}function get_PageTitle(pageRequested){var collectIssueTitle=set_PageTitle();return collectIssueTitle}function get_PageFeature(pageRequested){var collectPageFeature=set_PageFeature();return collectPageFeature}function get_debugMode(){var debugMode=set_debugMode();return debugMode}function get_channel(){var channel=set_channel();return channel}function get_language(){var language=set_language();return language}function get_assetPath(){var assetPath=set_assetPath();return assetPath}function get_cssAnimationEngine(){var cssAnimationEngine=set_cssAnimationEngine();return cssAnimationEngine}function get_jQueryAnimationEngine(){var jQueryAnimationEngine=set_jQueryAnimationEngine();return jQueryAnimationEngine}function get_javaScriptExtention(){var javaScriptExtention=set_javaScriptExtention();return javaScriptExtention}function get_hashBangStatus(){var hashBangStatus=set_hashBangStatus();return hashBangStatus}function get_baseLocation(){return BASE_LOCATION}return{set_PageTitle:set_PageTitle,set_PageFeature:set_PageFeature,get_initialPage:get_initialPage,get_IssueDate:get_IssueDate,get_IssueNumber:get_IssueNumber,get_PageTitle:get_PageTitle,get_PageFeature:get_PageFeature,get_IssueDevice:get_IssueDevice,get_debugMode:get_debugMode,get_channel:get_channel,get_language:get_language,get_jQueryMobileVersion:get_jQueryMobileVersion,get_cssAnimationEngine:get_cssAnimationEngine,get_jQueryAnimationEngine:get_jQueryAnimationEngine,get_baseLocation:get_baseLocation,get_hashBangStatus:get_hashBangStatus,init:init,magazineDebugLog:magazineDebugLog,magazineDebugObj:magazineDebugObj,loadJSDependencies:loadJSDependencies,magazineFileLoader:magazineFileLoader,stripPageID:stripPageID,addPageID:addPageID,dynamicSubSettingEnabled:dynamicSubSettingEnabled}}();var magazineBrowserDetection=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineBrowserDetection"});var cssPropertyAvailability,usersBrowserRequested,engineLoaded,pushHistoryAvailability=true;requestEngineAvailability(false);!function usersBrowserDetection(){function usersBrowserCapabilities(){var CSS3Property="transition";var prefixes="Webkit Moz O ms Khtml".split(" "),prefix,div=document.createElement("div"),i=0,prop=CSS3Property,support=div.style[prop]!=undefined;prop=prop.charAt(0).toUpperCase()+prop.slice(1);while(!support&&(prefix=prefixes[i++])){support=div.style[prefix+prop]!=undefined;requestPropertyAvailability(support)}}function requestPropertyAvailability(setStatus){if(setStatus==null){return cssPropertyAvailability}else{cssPropertyAvailability=setStatus}}function usersBrowser(){extendJqueryBrowser();var userBrowser=$.browser,selectedBrowser,isMobileDevice=false,animationEngineCompatible=true;if(userBrowser.msie){selectedBrowser="msie";if(userBrowser.version<8){animationEngineCompatible=false}}else{if(userBrowser.mozilla){selectedBrowser="mozilla"}else{if(userBrowser.webkit){if(navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("iPod")!=-1){selectedBrowser="iPhone_iPod";isMobileDevice=true;requestPushHistoryAvailability(checkIosVersion())}else{if(navigator.userAgent.indexOf("iPad")!=-1){selectedBrowser="iPad";isMobileDevice=true;requestPushHistoryAvailability(checkIosVersion())}else{if(navigator.userAgent.indexOf("Android")!=-1){selectedBrowser="Android";isMobileDevice=true}else{selectedBrowser="Webkit"}}}}else{if(userBrowser.opera){selectedBrowser="Opera"}else{if(navigator.userAgent.indexOf("BlackBerry")!=-1){selectedBrowser="BlackBerry";animationEngineCompatible=false;isMobileDevice=true}else{selectedBrowser="Unknown";animationEngineCompatible=false}}}}}requestUsersBrowser(selectedBrowser);requestMobileDeviceUseage(isMobileDevice);magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineBrowserDetection",functionName:"usersBrowser",msg:"users browser "+requestUsersBrowser(),lineNumber:(new Error).lineNumber});magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineBrowserDetection",functionName:"usersBrowser",msg:"user device, mobile:"+requestMobileDeviceUseage(),lineNumber:(new Error).lineNumber});return animationEngineCompatible}function extendJqueryBrowser(){jQuery.browser={};jQuery.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase());jQuery.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase());jQuery.browser.opera=/opera/.test(navigator.userAgent.toLowerCase());jQuery.browser.msie=/msie/.test(navigator.userAgent.toLowerCase());jQuery.browser.blink=/blink/.test(navigator.userAgent.toLowerCase())}function loadAnimationLib(){var cssLibAvailability=requestPropertyAvailability();if(cssLibAvailability==true){requestedEngine("CSS engine");requestEngineAvailability(true)}else{requestEngineAvailability(true);requestedEngine("No engine")}}!function init(){var animationEngineCompatible=usersBrowser();if(animationEngineCompatible){usersBrowserCapabilities();loadAnimationLib()}else{requestedEngine("No engine")}}()}();function checkIosVersion(){if(/OS [2-4]_\d(_\d)? like Mac OS X/i.test(navigator.userAgent)){return false}else if(/CPU like Mac OS X/i.test(navigator.userAgent)){return false}else{return true}}function requestPushHistoryAvailability(setStatus){if(setStatus==null){return pushHistoryAvailability}else{pushHistoryAvailability=setStatus}}function requestedEngine(setStatus){if(setStatus==null){return engineRequested}else{engineRequested=setStatus}}function requestEngineAvailability(setStatus){if(setStatus==null){return engineLoaded}else{engineLoaded=setStatus}}function requestUsersBrowser(setStatus){if(setStatus==null){return usersBrowserRequested}else{usersBrowserRequested=setStatus}}function requestMobileDeviceUseage(setStatus){if(setStatus==null){return userAgentRequested}else{userAgentRequested=setStatus}}return{requestUsersBrowser:requestUsersBrowser,requestEngineAvailability:requestEngineAvailability,requestedEngine:requestedEngine,requestMobileDeviceUseage:requestMobileDeviceUseage,requestPushHistoryAvailability:requestPushHistoryAvailability}}();var magazineInteractiveComponents=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineInteractiveComponents"});function contentRotator(selector,options){var DELAY_SPEED=3e3;var ANIMATION_SPEED=700;var classID=0;var collection;collection=new Array($(selector).length);$(selector).each(function(){var id=classID;var animationSpeed=ANIMATION_SPEED;var animationIn=animationSpeed;var animationOut=animationSpeed;var blend=false;var delay=DELAY_SPEED;var reverse=false;var crossFade=false;var scopeAll=false;if(options){if(options.animationSpeed){if(!isNaN(options.animationSpeed)){animationSpeed=options.animationSpeed;animationIn=animationSpeed;animationOut=animationSpeed}}if(options.animationIn){if(!isNaN(options.animationIn)){animationIn=options.animationIn}}if(options.animationOut){if(!isNaN(options.animationOut)){animationOut=options.animationOut}}if(options.delay){if(!isNaN(options.delay)){delay=options.delay}}if(options.blend){blend=true}if(options.reverse){reverse=true}if(options.crossFade){crossFade=true}if(options.spacing){spacing=options.spacing}if(options.speed){if(!isNaN(options.speed)){speed=options.speed}}if(options.scopeAll){scopeAll=true}}collection[id]=[];collection[id].This=$(this);collection[id].list=$("> ul, > ol ",this);collection[id].reverse=reverse;collection[id].delay=delay;collection[id].animationSpeed=animationSpeed;collection[id].animationIn=animationIn;collection[id].animationOut=animationOut;collection[id].scopeAll=scopeAll;collection[id].timeout;collection[id].crossFade=crossFade;collection[id].playing=false;collection[id].selector=selector;collection[id].reverse=reverse;if(collection[id].crossFade){collection[id].animationIn=collection[id].animationSpeed;collection[id].animationOut=collection[id].animationSpeed}$(collection[id].This).addClass("contentRotator");$("li:eq(0) ",collection[id].list).addClass("active");classID++});$(selector).data("collection",collection);function pause(rotator){rotator.playing=false;clearTimeout(rotator.timeout)}function start(rotator){rotator.playing=true;rotator.timeout=setTimeout(function(){var nextItem;if(rotator.reverse){if($("> li.active ",rotator.list).prev().length==0){nextItem=$("> li ",rotator.list).last()}else{nextItem=$("> li.active ",rotator.list).prev()}}else{if($("> li.active ",rotator.list).next().length>0){nextItem=$("> li.active ",rotator.list).next()}else{nextItem=$("> li:eq(0) ",rotator.list)}}if(rotator.crossFade){var longestDelay=Math.max(rotator.animationIn,rotator.animationOut);var useFadeIn=true?rotator.animationIn>rotator.animationOut:rotator.animationIn<rotator.animationOut;$("> li.active ",rotator.list).fadeOut(rotator.animationOut,function(){$(this).removeClass("active");start(rotator)});nextItem.fadeIn(rotator.animationIn,function(){$(this).addClass("active")});$("> li.active ",rotator.list).after(nextItem)}else{$("> li.active ",rotator.list).fadeOut(rotator.animationOut,function(){$(this).removeClass("active");nextItem.fadeIn(rotator.animationIn,function(){$(this).addClass("active");if(rotator.playing)start(rotator)})})}},rotator.delay)}function stopPageContentRotators(){for(var item in collection){pause(collection[item])}}function startPageContentRotators(){for(var item in collection){start(collection[item])}}return{stopPageContentRotators:stopPageContentRotators,startPageContentRotators:startPageContentRotators}}!function($){$.fn.allImagesLoaded=function(callback,options){var This=this;var size=$("img ",This).length;jQuery.data(This,"loaded");return this.each(function(){$("img ",this).each(function(){var image=new Image;image.onload=function(){if(jQuery.data(This,"loaded")==undefined){jQuery.data(This,"loaded",1)}else{var i=jQuery.data(This,"loaded");i++;jQuery.data(This,"loaded",i)}if(jQuery.data(This,"loaded")==size){(callback||function(){}).call()}};var source=$(this).attr("src");image.src=source})})}}(jQuery);function productCarousel(selector,options){var carouselID=0;var collection;var loadedImages=0;var imagesReady=false;var startWhenLoaded=false;var MODE_DESKTOP="desktop";var MODE_TOUCH="touch";var VERTICAL="vertical";var HORIZONTAL="horizontal";var INTERVAL_PACE=10;collection=new Array($(selector).length);imagesReady=true;$(selector).each(function(){var id=carouselID;var length=400;var orientation=HORIZONTAL;var mode=MODE_DESKTOP;var reverse=false;var spacing="30";var speed=INTERVAL_PACE;if(options){if(options.length){if(!isNaN(options.length)){length=options.length}}if(options.orientation==VERTICAL){orientation=VERTICAL}else if(options.orientation==HORIZONTAL){orientation=HORIZONTAL}if(options.mode){if(options.mode==true){mode=MODE_DESKTOP}else if(options.mode==false){mode=MODE_DESKTOP}}if(options.reverse){reverse=true}if(options.spacing){if(!isNaN(options.spacing)){spacing=options.spacing}}if(options.speed){if(!isNaN(options.speed)){speed=options.speed}}}collection[id]=[];collection[id].selector=selector;collection[id].This=$(this);collection[id].list=$("> ul",this);collection[id].orientation=orientation;collection[id].contentSize=0;collection[id].containerSize=length;collection[id].startTime;collection[id].animationInterval=0;collection[id].resetCountdown;collection[id].resetCountdownNumber=0;collection[id].reverse=reverse;collection[id].direction=reverse?"-":"+";collection[id].spacing=spacing;collection[id].speed=speed;collection[id].mode=mode;collection[id].animating;$(collection[id].This).addClass("productCarousel");$("> ul li",collection[id].This).clone().appendTo($("> ul",collection[id].This));collection[id].list.addClass(collection[id].orientation);$(selector).allImagesLoaded(function(){if(collection[id].orientation==VERTICAL){var IE7_max_width=0;$("> ul li a",collection[id].This).each(function(){$(this).css("padding-top",collection[id].spacing+"px");$(this).css("padding-bottom",collection[id].spacing+"px")});$("> ul img",collection[id].This).each(function(){collection[id].contentSize+=$(this).height()+collection[id].spacing*2;if($.browser.msie){if($.browser.version=="7.0"){collection[id].contentSize+=4;$(this).closest("li").height($(this).height()+collection[id].spacing*2+4);if($(this).width()>IE7_max_width){IE7_max_width=$(this).width();collection[id].This.width(IE7_max_width)}}}});if(collection[id].contentSize<=collection[id].containerSize*2){collection[id].containerSize=collection[id].contentSize/2;collection[id].This.height(collection[id].containerSize)}else{collection[id].This.height(collection[id].containerSize)}$("ul",collection[id].This).height(collection[id].contentSize)}else{$("> ul li a",collection[id].This).each(function(){$(this).css("padding-left",collection[id].spacing+"px");$(this).css("padding-right",collection[id].spacing+"px")});$("> ul img",collection[id].This).each(function(){collection[id].contentSize+=$(this).width()+collection[id].spacing*2;if($.browser.msie){if($.browser.version=="7.0"){collection[id].contentSize+=4;$(this).closest("li").width($(this).width()+collection[id].spacing*2+4)}}});if(collection[id].contentSize<=collection[id].containerSize*2){collection[id].containerSize=collection[id].contentSize/2;collection[id].This.width(collection[id].containerSize)}else{collection[id].This.width(collection[id].containerSize)}$("ul",collection[id].This).width(collection[id].contentSize)}collection[id].animationInterval=collection[id].contentSize*speed;$("> ul li img",collection[id].This).hover(function(){if(collection[id].animating){pauseCarousel(collection[id])}else{}},function(){animateCarousel(collection[id])});if(collection[id].mode==MODE_DESKTOP){carouselStartPoint(collection[id])}else if(collection[id].mode==MODE_TOUCH){}},{debug:collection[id].debug});if(startWhenLoaded){animateCarousel(collection[id])}carouselID++});function animateCarousel(carousel){if(imagesReady){carousel.startTime=new Date;if(carousel.resetCountdownNumber<=0){carousel.resetCountdownNumber=carousel.animationInterval}carousel.resetCountdown=setTimeout(function(){startResetCountdown(carousel)},carousel.resetCountdownNumber);if(carousel.orientation==VERTICAL){$(carousel.list).animate({top:carousel.direction+"="+carousel.contentSize/2+"px"},{duration:carousel.animationInterval,easing:"linear"})}else{$(carousel.list).animate({left:carousel.direction+"="+carousel.contentSize/2+"px"},{duration:carousel.animationInterval,easing:"linear"})}carousel.animating=true}else{startWhenLoaded=true}}function pauseCarousel(carousel){carousel.animating=false;carousel.list.stop();clearTimeout(carousel.resetCountdown);var s=carousel.startTime;var c=new Date;var startUTC=Date.UTC(s.getFullYear(),s.getMonth(),s.getDay(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds());var nowUTC=Date.UTC(c.getFullYear(),c.getMonth(),c.getDay(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds());var timeDifference=nowUTC-startUTC;carousel.resetCountdownNumber-=timeDifference}function startResetCountdown(carousel){carousel.list.stop();carousel.resetCountdownNumber=carousel.animationInterval;carouselStartPoint(carousel);animateCarousel(carousel)}function carouselStartPoint(carousel){if(carousel.orientation==VERTICAL){if(carousel.reverse){$(carousel.list).css("top","0px")}else{$(carousel.list).css("top","-"+carousel.contentSize/2+"px")}}else{if(carousel.reverse){$(carousel.list).css("left","0px")}else{$(carousel.list).css("left","-"+carousel.contentSize/2+"px")}}}function stopPageCarousels(){for(var carousel in collection){if(collection[carousel].mode==MODE_DESKTOP){pauseCarousel(collection[carousel])}}}function startPageCarousels(){for(var carousel in collection){if(!collection[carousel].animating&&collection[carousel].mode==MODE_DESKTOP){animateCarousel(collection[carousel])}else{}}}return{stopPageCarousels:stopPageCarousels,startPageCarousels:startPageCarousels}}function productOverlay(selector,options){var elementID=0;var closeAll=false;var clickSelfToClose=true;var fadeSpeed=500;var openDialogAtStart=false;var pidExists=false;var closeButtonName="closeButton";var closeButtonSelector="."+closeButtonName;var closeButtonMarkup='<span class="'+closeButtonName+'">[close]</span>';var collection=new Array($(selector).length);if(options){if(options.closeAll){if(options.closeAll==true){closeAll=true}}if(options.clickSelfToClose){if(options.clickSelfToClose==true){clickSelfToClose=true}}if(options.fadeSpeed||options.fadeSpeed==0){fadeSpeed=options.fadeSpeed}if(options.openDialogAtStart){if(options.openDialogAtStart==true){openDialogAtStart=true}}}$(selector).each(function(){var id=elementID;collection[id]={};collection[id].selector=selector;collection[id].This=$(this);collection[id].overlay=$("[rel="+selector+"]");collection[id].closeSelector;collection[id].closeAll=closeAll;collection[id].clickSelfToClose=clickSelfToClose;collection[id].isDialogOpen;collection[id].fadeSpeed=fadeSpeed;collection[id].openDialogAtStart=openDialogAtStart;collection[id].closeButtonSelector=closeButtonSelector;collection[id].This.css("cursor","pointer");if(collection[id].openDialogAtStart){showOverlay(collection[id],0)}else{hideOverlay(collection[id],0)}if(options){if(options.closeButtonSelector){if($(options.closeButtonSelector,collection[id].overlay).length>0){collection[id].closeButtonSelector=options.closeButtonSelector}}}$("a, map area",collection[id].overlay).each(function(){var href=$(this).attr("href");if(href){if(href.search("/product/")>-1){var pid=href.slice(9);if(!isNaN(pid)){pidExists=true}}}});if($(".closeButton ",collection[id].overlay).length>0&&pidExists){collection[id].closeSelector=$(collection[id].closeButtonSelector,collection[id].overlay)}else if($(collection[id].closeButtonSelector,collection[id].overlay).length>0){collection[id].closeSelector=$(collection[id].closeButtonSelector,collection[id].overlay)}else if(pidExists){collection[id].overlay.append(closeButtonMarkup);collection[id].closeSelector=$(collection[id].closeButtonSelector,collection[id].overlay)}else{collection[id].closeSelector=collection[id].overlay}collection[id].closeSelector.css("cursor","pointer");collection[id].This.click(function(){if(collection[id].clickSelfToClose&&collection[id].isDialogOpen){hideOverlay(collection[id])}else if(collection[id].closeAll==true){var magazineOverlayCollection=$("body").data("magazineOverlayCollection");for(var theCollection in magazineOverlayCollection){for(var element in magazineOverlayCollection[theCollection]){if(magazineOverlayCollection[theCollection][element]==collection[id]){showOverlay(collection[id])}else{hideOverlay(magazineOverlayCollection[theCollection][element])}}}}else{showOverlay(collection[id])}return false});collection[id].closeSelector.click(function(){hideOverlay(collection[id]);return false});if($("body").data("magazineOverlayCollection")==undefined){var magazineOverlayCollection=[];magazineOverlayCollection[selector]=collection;$("body").data("magazineOverlayCollection",magazineOverlayCollection)}else{var magazineOverlayCollection=$("body").data("magazineOverlayCollection");magazineOverlayCollection[selector]=collection;$("body").data("magazineOverlayCollection",magazineOverlayCollection)}elementID++});function showOverlay(elementObject,fadeSpeed){var speed;if(fadeSpeed==undefined){speed=elementObject.fadeSpeed}else{speed=fadeSpeed}elementObject.overlay.fadeIn(speed,function(){elementObject.isDialogOpen=true})}function hideOverlay(elementObject,fadeSpeed){var speed;if(fadeSpeed==undefined){speed=elementObject.fadeSpeed}else{speed=fadeSpeed}elementObject.overlay.fadeOut(speed,function(){elementObject.isDialogOpen=false})}}var videoPlayer=function(selector,options){var selectorID=0;var height=240;var width=320;var videoID=0;var userPlayerID="111993198001";var userPlayerKey="AQ~~,AAAAFLXwOAk~,L3ZpIEnPIc14r8SCKtcnekPSXaxbO0dZ";var autoPlay="false";var sel=selector;var collection=new Array($(selector).length);if(options){if(options.height){if(!isNaN(options.height)){height=options.height}else{}}else{}if(options.width){if(!isNaN(options.width)){width=options.width}else{}}else{}if(options.videoID){if(!isNaN(options.videoID)){videoID=options.videoID}else{}}else{}if(options.userPlayerID){if(!isNaN(options.userPlayerID)){userPlayerID=options.userPlayerID}else{}}else{}if(options.userPlayerKey){userPlayerKey=options.userPlayerKey}else{}if(options.autoStart){autoStart=true}else{autoStart=false}}$(selector).each(function(){var id=selectorID;var selectorFormatted=selector;selectorFormatted=selectorFormatted.replace(".","");selectorFormatted=selectorFormatted.replace("#","");selectorFormatted=selectorFormatted+"_"+id;collection[id]=[];collection[id].selector=selector;collection[id].selectorFormatted=selectorFormatted;collection[id].videoPlayer={};collection[id].playerData={playerID:userPlayerID,playerKey:userPlayerKey,width:width,height:height,autoStart:autoStart,videoID:videoID};collection[id].isPlayerAdded=false;collection[id].playerTemplate='<div style="display:none"></div><object id="'+selectorFormatted+'"" class="BrightcoveExperience"><param name="bgcolor" value="#000" /><param name="width" value="'+collection[id].playerData.width+'" /><param name="height" value="'+collection[id].playerData.height+'" /><param name="playerID" value="'+collection[id].playerData.playerID+'" /><param name="playerKey" value="'+collection[id].playerData.playerKey+'" /><param name="isVid" value="true" /><param name="isUI" value="true" /><param name="dynamicStreaming" value="true" /><param name="@videoPlayer" value="'+collection[id].playerData.videoID+'" /><param name="templateLoadHandler" value="magazineInteractiveComponents.onTemplateLoaded" /><param name="autoStart" value="'+collection[id].playerData.autoStart+'" /><param name="wmode" value="transparent"><param name="secureConnections" value="true" /><param name="secureHTMLConnections" value="true" />  </object>';collection[id].addPlayer=function(){if(collection[id].isPlayerAdded==false){collection[id].isPlayerAdded=true;var playerHTML="";$(selector).html(collection[id].playerTemplate);$.when($.getScript("https://sadmin.brightcove.com/js/BrightcoveExperiences.js"),$.getScript("https://sadmin.brightcove.com/js/APIModules_all.js"),$.Deferred(function(deferred){$(deferred.resolve)})).done(function(){brightcove.createExperiences();if(collection[id].playerData.autoStart){playVideoTracking(collection[id].playerData.videoID)}})}else{}};
collection[id].markup=function(html,data){var m;var i=0;var match=html.match(data instanceof Array?/{{\d+}}/g:/{{\w+}}/g)||[];while(m=match[i++]){html=html.replace(m,data[m.substr(2,m.length-4)])}return html};collection[id].removePlayer=function(){if(collection[id].isPlayerAdded==true){collection[id].isPlayerAdded=false;collection[id].experienceModule.unload();$(selector).html("")}};collection[id].addPlayer();if($("body").data("videoPlayerCollection")==undefined){var videoPlayerCollection=[];videoPlayerCollection[selector]=collection;$("body").data("videoPlayerCollection",videoPlayerCollection)}else{var videoPlayerCollection=$("body").data("videoPlayerCollection");videoPlayerCollection[selector]=collection;$("body").data("videoPlayerCollection",videoPlayerCollection)}selectorID++});function pauseVideo(){var videoCollection=$("body").data("videoPlayerCollection");var collection=videoCollection[sel];for(obj in collection){collection[obj].videoPlayer.pause()}}function playVideo(){var videoCollection=$("body").data("videoPlayerCollection");var collection=videoCollection[sel];for(obj in collection){collection[obj].videoPlayer.play();playVideoTracking(collection[obj].playerData.videoID)}}function playVideoTracking(brightcoveID){}return{pauseVideo:pauseVideo,playVideo:playVideo}};function onTemplateLoaded(ID){var player=brightcove.getExperience(ID);var experienceModule=player.getModule(APIModules.EXPERIENCE);var videoPlayer=player.getModule(APIModules.VIDEO_PLAYER);var collection=$("body").data("videoPlayerCollection");for(var obj in collection){var selectorCollection=collection[obj];for(var selector in selectorCollection){if(selectorCollection[selector].selectorFormatted==ID){var matchedCollection=selectorCollection[selector];matchedCollection.player=player;matchedCollection.experienceModule=experienceModule;matchedCollection.videoPlayer=videoPlayer}}}}return{contentRotator:contentRotator,productCarousel:productCarousel,productOverlay:productOverlay,videoPlayer:videoPlayer,onTemplateLoaded:onTemplateLoaded}}();var magazinePageAttachment=function(){var currentPage;magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazinePageAttachment"});function initPage(pageloaded){magazineJavaScriptEngine.dynamicFunctionCall("init",pageloaded)}function preparePage(pagePreparing){magazineLoader.magazineDebugLog({status:"prepare",namespace:"magazinePageAttachment",functionName:"preparePage",msg:"page "+pagePreparing,lineNumber:(new Error).lineNumber});if(magazinePageLoader.pageDownloadCheck(pagePreparing)){magazineJavaScriptEngine.dynamicFunctionCall("prepare",pagePreparing);magazineAnimationEngine.prepareAnimation(pagePreparing)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazinePageAttachment",functionName:"preparePage",msg:"page "+pagePreparing+" content not ready for prepare",lineNumber:(new Error).lineNumber})}var pagePrepareSelector=magazineLoader.addPageID(pagePreparing);$(pagePrepareSelector+" .magazineContent").css({visibility:"visible"})}function pageHookDetection(pageShowing){magazineLoader.magazineDebugLog({status:"hook",namespace:"magazinePageAttachment",functionName:"pageHookDetection",msg:"page "+pageShowing,lineNumber:(new Error).lineNumber});if(magazinePageLoader.pageDownloadCheck(pageShowing)){magazineJavaScriptEngine.dynamicFunctionCall("hook",pageShowing);magazineAnimationEngine.playAnimation(pageShowing)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazinePageAttachment",functionName:"pageHookDetection",msg:"page "+pageShowing+" content not ready for hook",lineNumber:(new Error).lineNumber})}magazinePageLoader.ajaxContentRequest(pageShowing);magazineBuilder.updateWebPageTitle(pageShowing);magazineBuilder.updatePageMetadata(pageShowing);magazineTracking.pageLoadTags(pageShowing);magazineBuilder.updateHistory(pageShowing)}function pageDetachDetection(pageLeaving){magazineLoader.magazineDebugLog({status:"detach",namespace:"magazinePageAttachment",functionName:"pageDetachDetection",msg:"page "+pageLeaving,lineNumber:(new Error).lineNumber});if(magazinePageLoader.pageDownloadCheck(pageLeaving)){magazineJavaScriptEngine.dynamicFunctionCall("detach",pageLeaving);magazineAnimationEngine.resetAnimation(pageLeaving)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazinePageAttachment",functionName:"pageDetachDetection",msg:"page "+pageLeaving+" content not ready for detach",lineNumber:(new Error).lineNumber})}var pageDetachSelector=magazineLoader.addPageID(pageLeaving);currentPage=magazineBuilder.get_CurrentPageNumber();if(currentPage!=pageLeaving){setTimeout(function(){$(pageDetachSelector+" .magazineContent").css({visibility:"hidden"})},magazineBuilder.get_MagazinePageTransition())}}return{pageHookDetection:pageHookDetection,preparePage:preparePage,pageDetachDetection:pageDetachDetection,initPage:initPage}}();var magazineTracking=function(){var globalPageTitle=null;magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineTracking"});function setReportingVariables(pageNumber){var napAnalytics=NAP.analytics,currentPage=typeof pageNumber!=undefined?pageNumber:magazineBuilder.get_CurrentPageNumber(),issueDate=magazineLoader.get_IssueDate(),featureTitle=magazineLoader.get_PageTitle(),featureType=magazineLoader.get_PageFeature();title="ISSUE "+issueDate+" - PAGE "+currentPage+" - "+featureTitle+" - "+featureType;napAnalytics.setPageName(title);napAnalytics.setPageVar("category","MAGAZINE");napAnalytics.setPageVar("department",issueDate);napAnalytics.setPageVar("subsection1",featureType);napAnalytics.setPageVar("subsection2",featureTitle+" - "+currentPage);return title}function pageLoadTags(pageShowing){var fire=true;var title=setReportingVariables(pageShowing);if(globalPageTitle!=title){if(!magazineLoader.get_debugMode()){try{if(fire){NAP.analytics.trackPageview();globalPageTitle=title;fire=false}}catch(err){magazineLoader.magazineDebugLog({status:"Critical error",namespace:"magazineTracking",functionName:"pageLoadTags",msg:"Tracking tags could not be loaded",lineNumber:(new Error).lineNumber})}}magazineLoader.magazineDebugLog({status:"Tracking",namespace:"magazineTracking",functionName:"pageLoadTags",msg:title,lineNumber:(new Error).lineNumber})}}function pageElementInteraction(elementType,identifier){var pageShowing=magazineBuilder.get_CurrentPageNumber();setReportingVariables(pageShowing);if(!magazineLoader.get_debugMode()){try{NAP.analytics.trackElement("Page "+pageShowing+" - "+elementType+" - "+identifier)}catch(err){magazineLoader.magazineDebugLog({status:"Critical error",namespace:"magazineTracking",functionName:"pageLoadTags",msg:"Tracking tags could not be loaded",lineNumber:(new Error).lineNumber})}}magazineLoader.magazineDebugLog({status:"Tracking",namespace:"magazineTracking",functionName:"pageElementInteraction",msg:title,lineNumber:(new Error).lineNumber})}return{pageLoadTags:pageLoadTags,pageElementInteraction:pageElementInteraction}}();var napProductInteractions=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"napProductInteractions"});var FADE_SPEED=200,DIALOG_SELECTOR=".popupContent",CAPTIONS_API="/webapi/feed/magazinecaption/",EXCLUDE_CALL="?exclude=true",STATUS_API,REGISTER_INTEREST_URL;var pids={},mousePosX,mousePosY,pageWidth,pageHeight,dialogWidth,dialogHeight,dialogX,dialogY,xPos,yPos;var rollOverImageMap,productStatus,animating;var txtGetTheLook="GET THE LOOK",txtShopNow="SHOP NOW",txtComingSoon="Coming soon",txtRegisterInterest="Register now",txtPreposition="by";txtRegisterInterestTitle="Item Update";txtRegisterInterestDesc="This product is not yet in stock";try{if(NAP.i18n.message("NAP.magazine.productDialog.txtGetTheLook")){txtGetTheLook=NAP.i18n.message("NAP.magazine.productDialog.txtGetTheLook")}if(NAP.i18n.message("NAP.magazine.productDialog.txtShopNow")){txtShopNow=NAP.i18n.message("NAP.magazine.productDialog.txtShopNow")}if(NAP.i18n.message("NAP.magazine.productDialog.txtComingSoon")){txtComingSoon=NAP.i18n.message("NAP.magazine.productDialog.txtComingSoon")}if(NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterest")){txtRegisterInterest=NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterest")}if(NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterestTitle")){txtRegisterInterestTitle=NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterestTitle")}if(NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterestDesc")){txtRegisterInterestDesc=NAP.i18n.message("NAP.magazine.productDialog.txtRegisterInterestDesc")}}catch(err){magazineLoader.magazineDebugLog({status:"Error",namespace:"napProductInteractions",functionName:"init",msg:"translation of JavaScript resource bundles failed, used defaults",lineNumber:(new Error).lineNumber})}function init(selector,options){var STATUS_API="/"+magazineLoader.get_channel()+"/api/feed/searchableproduct/status/",REGISTER_INTEREST_URL="/"+magazineLoader.get_channel()+"/productUpdatesRegistration.nap?productId=";pageWidth=$(selector).width();pageHeight=$(selector).height();$(document).mousemove(function(e){mousePosX=e.pageX;mousePosY=e.pageY});magazineLoader.magazineDebugLog({status:"debug",namespace:"napProductInteractions",functionName:"init",msg:"collect PIDs in image maps",lineNumber:(new Error).lineNumber});$(selector+" [href]").each(function(){var This=$(this);var href=$(This).attr("href");if(href.search("/product/")>-1){var pid=href.split("/product/")[1].split("/")[0].split("?")[0];if(pid){magazineLoader.magazineDebugLog({status:"request",namespace:"napProductInteractions",functionName:"init",msg:"Request data for "+pid,lineNumber:(new Error).lineNumber});getProductData(pid,CAPTIONS_API,{onComplete:function(data,textStatus,jqXHR){var jsonData=$.parseJSON(textStatus.responseText),modelRollOver;if(jsonData.magazineCaption){magazineLoader.magazineDebugLog({status:"success",namespace:"napProductInteractions",functionName:"init",msg:"PID ["+pid+"]: "+jsonData.magazineCaption.caption+" by "+jsonData.magazineCaption.designerName,lineNumber:(new Error).lineNumber});try{if(NAP.i18n.message("NAP.magazine.productDialog.txtProductBy")){var txtProductBy=NAP.i18n.message("NAP.magazine.productDialog.txtProductBy",[jsonData.magazineCaption.caption,jsonData.magazineCaption.designerName])}}catch(err){var txtProductBy=jsonData.magazineCaption.caption+" "+txtPreposition+" "+jsonData.magazineCaption.designerName;magazineLoader.magazineDebugLog({status:"Error",namespace:"napProductInteractions",functionName:"init",msg:"translation of JavaScript product data resource bundle failed, used defaults",lineNumber:(new Error).lineNumber})}productAvailability(pid,This,function(productStatus){modelRollOver='<div id="a" class="popupContent">'+"<h3>"+txtGetTheLook+"</h3>"+"<p>"+txtProductBy+"</p>"+"<h4>"+productStatus+"</h4>"+"</div>";initProductCaptions(This,modelRollOver)})}else{magazineLoader.magazineDebugLog({status:"error",namespace:"napProductInteractions",functionName:"init",msg:pid+" doesn't exist",lineNumber:(new Error).lineNumber});productAvailability(pid,This,function(productStatus){modelRollOver='<div id="a" class="popupContent">'+'<h3 class="comingSoon">'+txtRegisterInterest+"</h3>"+"</div>";initProductCaptions(This,modelRollOver)})}},onError:function(jqXHR){magazineLoader.magazineDebugLog({status:"critical error",namespace:"napProductInteractions",functionName:"init",msg:"Magazine caption request failed on pid:"+pid,lineNumber:(new Error).lineNumber});magazineLoader.magazineDebugObj(jqxhr);This.css("cursor","auto");This.click(function(){return false})}})}else{This.css("cursor","auto");This.click(function(){return false})}}});function initProductCaptions(This,modelRollOver){if(!magazineBrowserDetection.requestMobileDeviceUseage()){productHover(This,modelRollOver)}}function productAvailability(pid,imageMap,setupCaption){var productStatus=txtShopNow;getProductData(pid,STATUS_API,{onComplete:function(data,textStatus,jqXHR){var jsonProductData=$.parseJSON(textStatus.responseText);if(jsonProductData.productAvailability.status=="AVAILABLE"){magazineLoader.magazineDebugLog({status:"success",namespace:"napProductInteractions",functionName:"productAvailability",msg:"PID ["+pid+"]: Product Status AVAILABLE",lineNumber:(new Error).lineNumber});productStatus=txtShopNow}else{productStatus=txtRegisterInterest;magazineLoader.magazineDebugLog({status:"error",namespace:"napProductInteractions",functionName:"productAvailability",msg:"PID ["+pid+"]: Product Status "+jsonProductData.productAvailability.status,lineNumber:(new Error).lineNumber});var registerInterestPidURL=REGISTER_INTEREST_URL+pid;if(typeof NAP.overlayPanel=="function"){registerInterestPidURL=registerInterestPidURL+"&overlay=true";$(imageMap).click(function(){NAP.overlayPanel({title:txtRegisterInterestTitle+' - <span class="overlay-title-lc">'+txtRegisterInterestDesc+"</span>",message:"<iframe src='"+registerInterestPidURL+"' frameborder='0' id='registration-form' name='registrationFrame' height='500' width='850'></iframe>",type:"info",theme:"light",addClass:"print-dialog",width:888,height:554});return false})}else{$(imageMap).click(function(){window.location=registerInterestPidURL})}}setupCaption(productStatus)},onError:function(jqXHR){magazineLoader.magazineDebugLog({status:"critical error",namespace:"napProductInteractions",functionName:"productAvailability",msg:"Product availability request failed on pid:"+pid,lineNumber:(new Error).lineNumber});magazineLoader.magazineDebugObj(jqxhr);setupCaption("")}})}function productHover(imageMaps,modelRollOver){$(imageMaps).hover(function(){rollOverImageMap=true;$(DIALOG_SELECTOR).stop();$(DIALOG_SELECTOR).remove();$(selector).append(modelRollOver);updateProductPopup();animating=true;$(DIALOG_SELECTOR).fadeIn(FADE_SPEED,function(){animating=false});$(DIALOG_SELECTOR).hover(function(){$(DIALOG_SELECTOR).stop()},function(){if(!rollOverImageMap&&!animating){removePopupDialog()}})},function(){rollOverImageMap=false;removePopupDialog()});$(imageMaps).mousemove(function(e){updateProductPopup()})}function getProductData(pid,apiURL,options){var url;url=apiURL+pid+".json"+EXCLUDE_CALL;$.ajax({url:url,dataType:"json",success:function(data,textStatus,jqXHR){if(options){(options.onComplete||function(){}).call(data,textStatus,jqXHR)}},error:function(jqXHR,textStatus,errorThrown){if(options){(options.onError||function(){}).call(jqXHR,textStatus,errorThrown)}}})}function updateProductPopup(){dialogWidth=$(DIALOG_SELECTOR).width();dialogHeight=$(DIALOG_SELECTOR).height();xPos=mousePosX+20-$("#magazineHolder").offset().left;yPos=mousePosY+20-$("#magazineHolder").offset().top;dialogX=Math.min(xPos,pageWidth-dialogWidth-20);dialogY=Math.min(yPos,pageHeight-dialogHeight-20);$(DIALOG_SELECTOR).css({left:dialogX,top:dialogY})}function removePopupDialog(){$(DIALOG_SELECTOR).fadeOut(FADE_SPEED,function(){$(DIALOG_SELECTOR).remove()})}}return{init:init,pids:pids}}();var magazinePageLoader=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazinePageLoader"});var pageNumber;function pageDownloadCheck(pageRequested){if(pageRequested==0){return true}else{if(pageRequested==magazineBuilder.get_NumberOfPages()||pageRequested=="archive"){return true}else{var pageIndex="li#page"+pageRequested;if($(pageIndex).data("status")=="loaded"){return true}else{return false}}}}function ajaxContentRequest(pageRequested){var nextPage=pageRequested+1;var prevPage=pageRequested-1;if(magazineBuilder.get_IfCangoToNextPage()){loadNewPage(nextPage)}if(magazineBuilder.get_IfCangoToPreviousPage()){loadNewPage(prevPage)}}function loadNewPage(pageRequested){var pageIndex="li#page"+pageRequested;if(!$(pageIndex).data("status")){var issueNode=collectIssueNode();var pageNode=collectPageNode(pageIndex);if(issueNode&&pageNode){collectPageContent(pageIndex,pageNode,issueNode)}else{magazineLoader.magazineDebugLog({status:"error",namespace:"magazinePageLoader",functionName:"loadNewPage",msg:pageIndex+" does not contain the required node refs",lineNumber:(new Error).lineNumber})}}else{magazineLoader.magazineDebugLog({status:"debug",namespace:"magazinePageLoader",functionName:"loadNewPage",msg:pageIndex+" has already been loaded",lineNumber:(new Error).lineNumber})}}function collectIssueNode(){var issueNode=$("#magazineHolder").data("id");return issueNode}function collectPageNode(pageIndex){var pageNode=$(pageIndex).data("id");return pageNode}function collectPageContent(pageIndex,pageNode,issueNode){var EXCLUDE_CALL="&exclude=true";magazineLoader.magazineDebugLog({status:"request",namespace:"magazinePageLoader",functionName:"collectPageContent",msg:pageIndex+" has been requested",lineNumber:(new Error).lineNumber});$(pageIndex).attr("data-status","loading");var pageRequested=$.ajax({url:"/"+magazineLoader.get_channel()+"/magazineContent.nap?pageID="+pageNode+"&issueID="+issueNode+EXCLUDE_CALL,type:"GET",dataType:"html"});pageRequested.done(function(pageContent){magazineLoader.magazineDebugLog({status:"success",namespace:"magazinePageLoader",functionName:"collectPageContent",msg:pageIndex+" has been downloaded",lineNumber:(new Error).lineNumber});magazineLoader.magazineDebugLog({status:"success",namespace:"magazinePageLoader",functionName:"collectPageContent",msg:"Alfresco node - "+pageNode,lineNumber:(new Error).lineNumber});setupPageContent(pageIndex,pageContent)});pageRequested.fail(function(jqxhr){magazineLoader.magazineDebugLog({status:"critical error",namespace:"magazinePageLoader",functionName:"collectPageContent",msg:"Request failed on node ref:"+pageNode,lineNumber:(new Error).lineNumber});magazineLoader.magazineDebugObj(jqxhr);setupPageContent(pageIndex,"Page failed to load, please try again later")})}function setupPageContent(pageIndex,pageContent){magazineLoader.magazineDebugLog({status:"modify",namespace:"magazinePageLoader",functionName:"collectPageContent",msg:"Page content injected into "+pageIndex,lineNumber:(new Error).lineNumber});$(pageIndex).attr("data-status","loaded");injectContent(pageIndex,pageContent);napProductInteractions.init(pageIndex);var pageID=pageIndex.split("li#")[1];if(magazineLoader.dynamicSubSettingEnabled()){MonoTypeWebFonts.renderPartial(pageID)}}function injectContent(pageIndex,pageContent){var pageType=magazineBuilder.collectPageIDTags("feature-type",pageIndex,"editorial");switch(pageType){case"editorial":var scriptTag="<"+"/script>";var contentStart=pageContent.split('<script type="text/javascript">');if(contentStart[1]){var javaScriptStart=contentStart[1].split(scriptTag),contentEnd=javaScriptStart[1],contentBlock=contentStart[0],javaScriptBlock=javaScriptStart[0],contentBlockClose=contentEnd;$(pageIndex+" .magazineContent").html(contentBlock+contentBlockClose);var newScript=document.createElement("script");newScript.type="text/javascript";newScript.text=javaScriptBlock;var pageSetUp=$(pageIndex+" .magazineContent").get(0);pageSetUp.appendChild(newScript);pageNumber=pageIndex.split("li#page")[1];magazinePageAttachment.initPage(pageNumber)}else{$(pageIndex+" .magazineContent").html(pageContent)};break;default:$(pageIndex+" .magazineContent").html(pageContent);break}}return{ajaxContentRequest:ajaxContentRequest,pageDownloadCheck:pageDownloadCheck,loadNewPage:loadNewPage,injectContent:injectContent}}();var magazineAnimationEngine=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineAnimationEngine"});var magazineControllerVis,magazineControllerInterface,magazinePage;function prepareAnimation(pageRequested){if(magazineBrowserDetection.requestEngineAvailability()){magazineAnimationRender.prepareAnimationController(pageRequested)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineAnimationEngine",functionName:"prepareAnimation",msg:magazineBrowserDetection.requestedEngine()+" not downloaded, can't prepare animation",lineNumber:(new Error).lineNumber})}}function playAnimation(pageRequested){if(magazineBrowserDetection.requestEngineAvailability()){if(magazineAnimationRender.prepareAnimationControllerStatus()){magazineAnimationRender.applyAnimationController(pageRequested)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineAnimationEngine",functionName:"playAnimation",msg:"prepareAnimation() was never called on page"+pageRequested+", playAnimation() can't be called'",lineNumber:(new Error).lineNumber})}}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineAnimationEngine",functionName:"playAnimation",msg:magazineBrowserDetection.requestedEngine()+" not downloaded, can't play animation",lineNumber:(new Error).lineNumber})}}function resetAnimation(pageRequested){if(magazineBrowserDetection.requestEngineAvailability()){if(magazineAnimationRender.prepareAnimationControllerStatus()){magazineAnimationRender.removeAnimationController(pageRequested)}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineAnimationEngine",functionName:"resetAnimation",msg:"prepareAnimation() was never called on page"+pageRequested+", resetAnimation() can't be called'",lineNumber:(new Error).lineNumber})}}else{magazineLoader.magazineDebugLog({status:"warning",namespace:"magazineAnimationEngine",functionName:"resetAnimation",msg:magazineBrowserDetection.requestedEngine()+" not downloaded, can't reset animation",lineNumber:(new Error).lineNumber})}}return{prepareAnimation:prepareAnimation,playAnimation:playAnimation,resetAnimation:resetAnimation}}();var magazineJavaScriptEngine=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineJavaScriptEngine"});var initRegex=/pageinit_\w*/,prepareRegex=/pagePrepare_\w*/,attachRegex=/pageAttach_\w*/,detachRegex=/pageDetach_\w*/,userBrowser,userMobileDevice;function dynamicFunctionCall(functionName,requestedPage){if(!userBrowser){userBrowser=magazineBrowserDetection.requestUsersBrowser()}if(!userMobileDevice){userMobileDevice=magazineBrowserDetection.requestMobileDeviceUseage()}if(requestedPage>"0"){var requestPageID="li#page"+requestedPage+" ";switch(functionName){case"prepare":selectedRegex=prepareRegex;break;case"hook":selectedRegex=attachRegex;break;case"detach":selectedRegex=detachRegex;break;case"init":selectedRegex=initRegex;break}if($(requestPageID+" .magazineContent").html()){var javaScriptDiv=$(requestPageID+" .magazineContent").html();try{var prepareFunction=javaScriptDiv.match(selectedRegex);if(prepareFunction){if(typeof window[prepareFunction]==="function"){window[prepareFunction](requestPageID,userBrowser,userMobileDevice);magazineLoader.magazineDebugLog({status:"execute",namespace:"magazineJavaScriptEngine",functionName:"dynamicFunctionCall",msg:"function "+prepareFunction+" on "+requestPageID,lineNumber:(new Error).lineNumber})}}}catch(err){magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineJavaScriptEngine",functionName:"dynamicFunctionCall",msg:"No "+functionName+" on "+requestPageID,lineNumber:(new Error).lineNumber})}}}}return{dynamicFunctionCall:dynamicFunctionCall}}();var magazineBuilder=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineBuilder"});var BASE_WINDOW_TITLE=" | NET-A-PORTER.COM",MAGAZINE_PAGE_TRANSITION=500,CONTENT_PAGE_DIV="#contents",ARCHIVE_PAGE_DIV="li#archive",BASE_HASH_BANG_URL,BASE_EMAIL_URL,BASE_URL;set_initialLoad(true);function cleanBaseURL(locationURL){var magazineBaseURL=magazineLoader.get_baseLocation(),CLEAN_BASE_URL;if(!magazineLoader.get_hashBangStatus()){if(locationURL.split(magazineBaseURL).length==1){CLEAN_BASE_URL=locationURL.split(magazineBaseURL)[0]+"/"+magazineLoader.get_IssueNumber()+"/"}else{if(locationURL.split(magazineBaseURL).length>=1){CLEAN_BASE_URL=locationURL.split(magazineBaseURL)[0]+magazineBaseURL+"/"+magazineLoader.get_IssueNumber()+"/"}}}else{CLEAN_BASE_URL=locationURL.split("#")[1]}return CLEAN_BASE_URL}var mouseTimer,_currentPageIndex,_numberOfPages,_pageWidth,_pageHeight,_usingMobileBrowser,_ifMouseIsOverControl,previousPage,transitionAnimationBusy=false,gestureAvailability=true,pushStatusState,initialLoad,runPollTimer=false,initialHistory=true,magazineDirection;function createMagazine(){var initialPage=magazineLoader.get_initialPage(),pageContent=$(magazineLoader.addPageID(initialPage)+" .magazineContent").html();pageSelector=magazineLoader.addPageID(initialPage),BASE_HASH_BANG_URL="!/"+magazineLoader.get_IssueNumber()+"/",BASE_URL=cleanBaseURL(location.href),BASE_EMAIL_URL=getEmailURL();$("#magazineHolder #totalIssuePages").width(get_NumberOfPages()*get_PageWidth());$("#magazineHolder #marker #last").text(get_NumberOfPages()-1);updateCurrentPageMarker(get_CurrentPageNumber());bindControls();$(".magazineContent ").css({visibility:"hidden"});magazinePageAttachment.initPage(initialPage);initialPageSelector(initialPage);napProductInteractions.init(pageSelector)}function bindControls(){bindPageControls();if(get_IfUsingMobileBrowser()){bindMobileControls()}else{bindKeyControls()}}function bindPageControls(){$("#magazineHolder .next.control").bind("click",goToNextPage);$("#magazineHolder .prev.control").bind("click",goToPreviousPage);$("#magazineFooter .next.control").bind("click",goToNextPage);$("#magazineFooter .prev.control").bind("click",goToPreviousPage);$("#magazineFooter #button-content").bind("click",function(){loadContentsPage();return false});$("#magazineFooter #button-archive").bind("click",function(){jumpToPage(get_NumberOfPages());return false})}function bindKeyControls(){$(document).keyup(function(e){var code=e.keyCode?e.keyCode:e.which;if(code==37){goToPreviousPage()}if(code==39){goToNextPage()}})}function bindMobileControls(){magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineBuilder",functionName:"bindMobileControls",msg:"Bind mobile controls",lineNumber:(new Error).lineNumber});var touchDeviceGesture=new Hammer(document.getElementById("magazineHolder"),{prevent_default:false,swipe_min_distance:100,swipe_time:1e3});touchDeviceGesture.onswipe=function(e){if(e.direction=="left"){goToNextPage()}if(e.direction=="right"){goToPreviousPage()}}}function bindMouse(){$(".control").bind("mouseenter",set_MouseIsOverControl);$(".control").bind("mouseleave",set_MouseIsNotOverControl);$(document).bind("mousemove",updateNavControls)}function updateNavControls(){if(get_IfCangoToNextPage()){$(".control.next").fadeIn("fast")}if(get_IfCangoToPreviousPage()||get_IfCanShowContentsPage()){$(".control.prev").fadeIn("fast")}}function goToNextPage(){if(get_IfCangoToNextPage()&&transitionAnimationBusy==false){magazineDirection="next";var currentPage=get_CurrentPageNumber();set_CurrentPageIndex(get_CurrentPageIndex()+1);stopHiFidelityFeatures(currentPage);updateNavControls();transitionPage()}return false}function goToPreviousPage(){if(!get_IfCangoToPreviousPage()&&get_IfCanShowContentsPage()&&transitionAnimationBusy==false){magazineDirection="prev";loadContentsPage()}else if(get_IfCangoToPreviousPage()&&transitionAnimationBusy==false){magazineDirection="prev";var previousPage=get_CurrentPageNumber();set_CurrentPageIndex(get_CurrentPageIndex()-1);stopHiFidelityFeatures(previousPage);updateNavControls();transitionPage()}return false}function updateNavHref(currentPage){if(currentPage<=1){var previousPage="contents"}else{var previousPage=currentPage-1}if(currentPage>=get_NumberOfPages()){var nextPage=currentPage}else{var nextPage=currentPage+1}var navHrefURL=magazineLoader.get_baseLocation()+magazineLoader.get_IssueNumber()+"/";$(".control.next").attr("href",navHrefURL+nextPage);$(".control.prev").attr("href",navHrefURL+previousPage);if(BASE_EMAIL_URL){$("#button-share").attr("href",BASE_EMAIL_URL+magazineLoader.get_IssueNumber()+"/"+currentPage)}}function getEmailURL(){var url;if($("#button-share").attr("href")){url=$("#button-share").attr("href").split("magazine")[0]+"magazine/"}else{url=false}return url}function initialPageSelector(desiredPage){if(desiredPage>get_NumberOfPages()||desiredPage<0){magazineLoader.magazineDebugLog({status:"error",namespace:"magazineBuilder",functionName:"initialPageSelector",msg:"page "+desiredPage+" doesn't exist, loading content page"});loadContentsPage()}else{switch(desiredPage){case 0:case"0":case"contents":case"Contents":$("#magazineHolder #contents").removeClass("hidden");loadContentsPage(get_initialLoad());break;case get_NumberOfPages():case"archive":case"Archive":$("#magazineHolder #archive").removeClass("hidden");pageJump=get_NumberOfPages();jumpToPage(pageJump,get_initialLoad());break;default:$("#magazineHolder #totalIssuePages .page").removeClass("hidden");jumpToPage(desiredPage,get_initialLoad())}}set_initialLoad(false)}function loadContentsPage(initial){magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineBuilder",functionName:"loadContentsPage",msg:"load contents page"});var currentPage=get_CurrentPageNumber();set_CurrentPageNumber(0);if(!initial){stopHiFidelityFeatures(currentPage)}updateNavHref(0);var height=$("#contents").height()+32;height=height<624?624:height;$("#magazineHolder").height(624).animate({height:height},"slow");$("div#contents").fadeIn("slow");$(".control.next").fadeIn("slow");$(".control.prev").fadeOut("slow");updateCurrentPageMarker(get_CurrentPageNumber());updateWebPageTitle(get_CurrentPageNumber());beginHiFidelityFeatures(get_CurrentPageNumber())}function updateWebPageTitle(pageShowing){var pageIndex="li#page"+pageShowing,pageTitle;switch(pageShowing){case 0:case"0":case"contents":case"Contents":pageTitle=collectPageIDTags("window-title",CONTENT_PAGE_DIV,"contents");break;case get_NumberOfPages():case"archive":case"Archive":pageTitle=collectPageIDTags("window-title",ARCHIVE_PAGE_DIV,"archive");break;default:pageTitle=collectPageIDTags("window-title",pageIndex,"Page "+pageShowing)}window.document.title=pageTitle+BASE_WINDOW_TITLE}function updateHistory(pageShowing){if(browserHistoryAvailability()){if(get_PushStatusChecker()!=pageShowing){switch(pageShowing){case 0:case"0":case"contents":case"Contents":typeOfHistory({id:"contents"},"contents",BASE_URL+"contents");break;case get_NumberOfPages():case"archive":case"Archive":typeOfHistory({id:magazineLoader.get_IssueNumber()},"archive",BASE_URL+"archive");break;default:typeOfHistory({id:pageShowing},pageShowing,BASE_URL+pageShowing)}}}else{pollForHashBangChanges();updateHashBang(pageShowing)}window.onpopstate=function(e){if(browserHistoryAvailability()){if(e.state){if(e.state.id=="contents"){set_PushStatusChecker(e.state.id);loadContentsPage()}else{set_PushStatusChecker(e.state.id);jumpToPage(e.state.id)}}}}}function typeOfHistory(historyID,historyTitle,historyURL){if(initialHistory){history.replaceState(historyID,historyTitle,historyURL);initialHistory=false}else{history.pushState(historyID,historyTitle,historyURL)}}function updateHashBang(pageShowing){var pageIndex="li#page"+pageShowing;switch(pageShowing){case 0:case"0":case"contents":case"Contents":pageTitle="contents";window.location.hash=BASE_HASH_BANG_URL+pageTitle;break;case get_NumberOfPages():case"archive":case"Archive":pageTitle="archive";window.location.hash=BASE_HASH_BANG_URL+pageTitle;break;default:window.location.hash=BASE_HASH_BANG_URL+pageShowing}}function pollForHashBangChanges(){if(!runPollTimer){runPollTimer=true;setInterval(function(){var updatePage=window.location.hash.substring(1);if(transitionAnimationBusy==false){if(updatePage){if(updatePage.split("/").length>=3){desiredPage=updatePage.split("/")[2];switch(desiredPage){case"contents":case"Contents":desiredPage=0;break;case"archive":case"Archive":desiredPage=get_NumberOfPages();break}if(desiredPage!=get_CurrentPageNumber()){initialPageSelector(desiredPage)}}}}},500)}}function browserHistoryAvailability(){if(history.pushState&&history.replaceState&&magazineBrowserDetection.requestPushHistoryAvailability()){return true}else{return false}}function updatePageMetadata(pageShowing){var pageIndex="li#page"+pageShowing,pageTitle;switch(pageShowing){case 0:case"0":case"contents":case"Contents":pageTitle=collectPageIDTags("page-title",CONTENT_PAGE_DIV,"contents");pageFeature=collectPageIDTags("feature-title",CONTENT_PAGE_DIV,"contents page");
break;case get_NumberOfPages():case"archive":case"Archive":pageTitle=collectPageIDTags("page-title",ARCHIVE_PAGE_DIV,"archive");pageFeature=collectPageIDTags("feature-title",ARCHIVE_PAGE_DIV,"archive");break;default:pageTitle=collectPageIDTags("page-title",pageIndex,"page "+pageShowing);pageFeature=collectPageIDTags("feature-title",pageIndex,"feature")}magazineLoader.set_PageTitle(pageTitle);magazineLoader.set_PageFeature(pageFeature)}function collectPageIDTags(idTag,pageRequested,fallback){if($(pageRequested).data(idTag)){return $(pageRequested).data(idTag)}else{return fallback}}function jumpToPage(pageNumber,initial){magazineLoader.magazineDebugLog({status:"debug",namespace:"magazineBuilder",functionName:"jumpToPage",msg:"jump to page "+pageNumber});var currentPage=get_CurrentPageNumber();set_CurrentPageNumber(pageNumber);if(!initial){stopHiFidelityFeatures(currentPage)}updateNavControls();transitionPage();transitionPage();magazinePageLoader.loadNewPage(pageNumber);return false}function beginHiFidelityFeatures(pageNumber){magazinePageAttachment.pageHookDetection(pageNumber)}function transitionPage(){startTransition();var movement=0-get_CurrentPageIndex()*get_PageWidth();$("#magazineHolder #totalIssuePages").animate({left:movement+"px"},{duration:MAGAZINE_PAGE_TRANSITION,queue:true,complete:endTransition});$("#magazineHolder").animate({height:624},"slow");updateCurrentPageMarker(get_CurrentPageNumber());$("#magazineHolder #contents").fadeOut("slow");if(!get_IfCangoToNextPage()){$(".control.next").fadeOut("fast");$(".next.navButton.control").fadeOut("fast")}if(!(get_IfCangoToPreviousPage()||get_IfCanShowContentsPage())){$(".control.prev").fadeOut("fast");$(".prev.navButton.control").fadeOut("fast")}}function startTransition(){if(magazineDirection=="prev"){previousPage=get_CurrentPageNumber()+1}else if(magazineDirection=="next"){previousPage=get_CurrentPageNumber()-1}else{previousPage=null}magazinePageAttachment.preparePage(get_CurrentPageNumber());set_transitionAnimationBusy(true)}function endTransition(){set_transitionAnimationBusy(false);beginHiFidelityFeatures(get_CurrentPageNumber());updateNavHref(get_CurrentPageNumber())}function set_transitionAnimationBusy(setStatus){transitionAnimationBusy=setStatus}function stopHiFidelityFeatures(pageNumber){magazinePageAttachment.pageDetachDetection(pageNumber)}function updateCurrentPageMarker(pageNumber){var pageIndex="li#page"+pageNumber;switch(pageNumber){case 0:$("#magazineFooter #marker #first").hide();$("#magazineFooter #marker #divider").hide();$("#magazineFooter #marker #last").hide();var requiredPage=collectPageIDTags("page-title",CONTENT_PAGE_DIV,"contents");break;case get_NumberOfPages():$("#magazineFooter #marker #first").hide();$("#magazineFooter #marker #divider").hide();$("#magazineFooter #marker #last").hide();var requiredPage=collectPageIDTags("page-title",ARCHIVE_PAGE_DIV,"archive");break;default:var pageType=collectPageIDTags("feature-type",pageIndex,"editorial");if(pageType=="promo"){$("#magazineFooter #marker #first").hide();$("#magazineFooter #marker #divider").hide();$("#magazineFooter #marker #last").hide();var requiredPage=collectPageIDTags("feature-title",pageIndex,"advertisement")}else{$("#magazineFooter #marker #first").show();$("#magazineFooter #marker #divider").show();$("#magazineFooter #marker #last").show();var requiredPage=pageNumber}}$("#magazineFooter #marker #current .number").text(requiredPage)}String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})};String.prototype.startsWith=function(str){return this.indexOf(str)==0};String.prototype.isInt=function(){return parseFloat(this)==parseInt(this)&&!isNaN(this)};function isInt(value){return parseFloat(value)==parseInt(value)&&!isNaN(value)}function set_CurrentPageNumber(pageNumber){set_CurrentPageIndex(pageNumber-1)}function set_CurrentPageIndex(i){_currentPageIndex=i}function set_IfMouseIsOverControl(booleanValue){_ifMouseIsOverControl=booleanValue}function set_PushStatusChecker(setStatus){if(!setStatus){return pushStatusState}else{pushStatusState=setStatus}}function set_initialLoad(setStatus){if(setStatus==null){return initialLoad}else{initialLoad=setStatus}}function get_CurrentPageNumber(){return get_CurrentPageIndex()+1}function get_CurrentPageIndex(){if(_currentPageIndex==null){_currentPageIndex=0}return _currentPageIndex}function get_IfMouseIsOverControl(){if(_ifMouseIsOverControl==null){_ifMouseIsOverControl=true}return _ifMouseIsOverControl}function get_NumberOfPages(){if(_numberOfPages==null){_numberOfPages=$("#magazineHolder #totalIssuePages").children(".page").length}return _numberOfPages}function get_PageWidth(){if(_pageWidth==null){_pageWidth=$("#magazineHolder #totalIssuePages").children(".page").first().width()}return _pageWidth}function get_PageHeight(){if(_pageHeight==null){_pageHeight=$("#magazineHolder #totalIssuePages").children(".page").first().height()}return _pageHeight}function get_PageWidthInPixels(){return _pageWidth+"px"}function get_IfContentsPageIsLoaded(){return $("div#contents").length>0}function get_IfUsingMobileBrowser(){if(_usingMobileBrowser==null){_usingMobileBrowser=magazineBrowserDetection.requestMobileDeviceUseage()}return _usingMobileBrowser}function get_IfCangoToNextPage(){return get_CurrentPageNumber()<get_NumberOfPages()}function get_IfCangoToPreviousPage(){return get_CurrentPageIndex()>0}function get_IfCanShowContentsPage(){return get_CurrentPageIndex()>=0}function get_MagazinePageTransition(){return MAGAZINE_PAGE_TRANSITION}function get_PushStatusChecker(){var pushStatusStateCheck=set_PushStatusChecker();return pushStatusStateCheck}function get_initialLoad(){return set_initialLoad()}return{createMagazine:createMagazine,goToNextPage:goToNextPage,goToPreviousPage:goToPreviousPage,jumpToPage:jumpToPage,get_IfCangoToNextPage:get_IfCangoToNextPage,get_IfCangoToPreviousPage:get_IfCangoToPreviousPage,updateWebPageTitle:updateWebPageTitle,updateHashBang:updateHashBang,updateHistory:updateHistory,get_CurrentPageNumber:get_CurrentPageNumber,updatePageMetadata:updatePageMetadata,get_NumberOfPages:get_NumberOfPages,get_PageWidth:get_PageWidth,get_PageHeight:get_PageHeight,get_MagazinePageTransition:get_MagazinePageTransition,collectPageIDTags:collectPageIDTags,loadContentsPage:loadContentsPage,get_initialLoad:get_initialLoad,get_IfUsingMobileBrowser:get_IfUsingMobileBrowser}}();var magazineAnimationRender=function(){magazineLoader.magazineDebugLog({status:"loaded",namespace:"magazineAnimationRender[CSS]"});var mozillaEngine="-moz-";var webkitEngine="-webkit-";var operaEngine="-o-";var userBrowser=magazineBrowserDetection.requestUsersBrowser();switch(userBrowser){case"Firefox":userRenderingEngine=mozillaEngine;break;case"Opera":userRenderingEngine=operaEngine;break;default:userRenderingEngine=webkitEngine}var userTransition=userRenderingEngine+"transition",userAnimation=userRenderingEngine+"animation",divWidth,divHeight,preparePage,animatePage,resetPage,endPositionArray=new Array,elementIDArray=new Array,arrayPointer,magazineWidth,magazineHeight,prepareStatus;function prepareAnimationControllerStatus(setStatus){if(setStatus){prepareStatus=setStatus}else{return prepareStatus}}function storePrepareAnimationData($this,position){if(endPositionArray.length==0){endPositionArray.push({ID:$this.attr("id"),Position:$this.css(position)});elementIDArray.push($this.attr("id"))}else{if(jQuery.inArray($this.attr("id"),elementIDArray)==-1){endPositionArray.push({ID:$this.attr("id"),Position:$this.css(position)});elementIDArray.push($this.attr("id"))}}}function splitStandardTransition($this,animationType){i=$this.attr("class").split("anim-"+animationType+"-Time-");animTimer=i[1].split("-Pause-");j=$this.attr("class").split("-Pause-");animEasing=j[1].split("-");if(animEasing[1]){animEasing=animEasing[1].split(" ")[0]}else{animEasing="linear"}k=$this.attr("class").split("anim-"+animationType+"-Time-");k2=k[1].split("-Pause-");animPause=k2[1].split("-");return{animTimer:animTimer[0],animEasing:animEasing,animPause:animPause[0]}}function splitCustomTransition($this){r=$this.attr("class").split("-Time-");animName=r[0];i=$this.attr("class").split(animName+"-Time-");animTimer=i[1].split("-Pause-");k=$this.attr("class").split(animName+"-Time-");k2=k[1].split("-Pause-");animPause=k2[1].split("-");v=$this.attr("class").split(animName+"-Time-");vTest=$this.attr("class").split("-Loop-");if(vTest.length>1){v2=v[1].split("-Loop-");animLoop=v2[1].split("-");animLoop=animLoop[0]}else{animLoop="1"}w=$this.attr("class").split(animName+"-Time-");wTest=$this.attr("class").split("-Direction-");if(wTest.length>1){w2=w[1].split("-Direction-");animDirection=w2[1].split("-");if(animDirection[0]=="alternate"||animDirection[0]=="Alternate"){animDirection="alternate"}else{animDirection="normal"}}else{animDirection="normal"}return{animName:animName,animTimer:animTimer[0],animPause:animPause[0],animLoop:animLoop,animDirection:animDirection}}function prepareAnimationController(requestedPage){preparePage="li#page"+requestedPage+" ",magazineWidth=magazineBuilder.get_PageWidth(),magazineHeight=magazineBuilder.get_PageHeight();prepareAnimationControllerStatus(true);if(elementIDArray.length==0){arrayPointer=0}!function prepareAnimationFadeIn(){$(preparePage+"[class^=anim-FadeIn]").each(function(){var $this=$(this);$this.css({userTransition:"",opacity:"0"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFadeIn",msg:"prepare fade in on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function prepareAnimationFadeOut(){$(preparePage+"[class^=anim-FadeOut]").each(function(){var $this=$(this);$this.css({userTransition:"",opacity:"1"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFadeOut",msg:"prepare fade out on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function prepareAnimationFromLeft(){$(preparePage+"[class^=anim-FromLeft]").each(function(){var $this=$(this);var divWidth=parseInt($this.width());storePrepareAnimationData($this,"left");$this.css({userTransition:"",left:"-"+divWidth+"px"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFromLeft",msg:"prepare from left on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function prepareAnimationFromRight(){$(preparePage+"[class^=anim-FromRight]").each(function(){var $this=$(this);storePrepareAnimationData($this,"left");$this.css({userTransition:"",left:magazineWidth+"px"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFromRight",msg:"prepare from right on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function prepareAnimationFromTop(){$(preparePage+"[class^=anim-FromTop]").each(function(){var $this=$(this);divHeight=parseInt($this.height());storePrepareAnimationData($this,"top");$this.css({userTransition:"",top:"-"+divHeight+"px"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFromTop",msg:"prepare from top on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function prepareAnimationFromBottom(){$(preparePage+"[class^=anim-FromBottom]").each(function(){var $this=$(this);storePrepareAnimationData($this,"top");$this.css({userTransition:"",top:magazineHeight+"px"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareAnimationFromBottom",msg:"prepare from bottom on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();if(userRenderingEngine!=operaEngine){!function prepareCustomAnimation(){$(preparePage+"[class^=anim-Custom]").each(function(){var $this=$(this);$this.css({visibility:"hidden"});magazineLoader.magazineDebugLog({status:"prepare animation",namespace:"magazineAnimationRender",functionName:"prepareCustomAnimation",msg:"prepare from custom on "+preparePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}()}}function applyAnimationController(requestedPage){var animatePage="li#page"+requestedPage+" ";!function animationFadeIn(){$(animatePage+"[class^=anim-FadeIn]").each(function(){var $this=$(this);var animationObj=splitStandardTransition($this,"FadeIn");$this.toggleClass("animate");$($this,".animate").css(userTransition,"opacity "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css({opacity:"1"});magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFadeIn",msg:"fade in "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function animationFadeOut(){$(animatePage+"[class^=anim-FadeOut]").each(function(){var $this=$(this);var animationObj=splitStandardTransition($this,"FadeOut");$this.toggleClass("animate");$($this,".animate").css(userTransition,"opacity "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css({opacity:"0"});magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFadeOut",msg:"fade out "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function animationFromLeft(){$(animatePage+"[class^=anim-FromLeft]").each(function(){var $this=$(this);arrayPointer=jQuery.inArray($this.attr("id"),elementIDArray);var animationObj=splitStandardTransition($this,"FromLeft");$this.toggleClass("animate");$($this,".animate").css(userTransition,"all "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css("left",endPositionArray[arrayPointer].Position);magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFromLeft",msg:"from left to "+endPositionArray[arrayPointer].Position+" on "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function animationFromRight(){$(animatePage+"[class^=anim-FromRight]").each(function(){var $this=$(this);arrayPointer=jQuery.inArray($this.attr("id"),elementIDArray);var animationObj=splitStandardTransition($this,"FromRight");$($this,".animate").css(userTransition,"all "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css("left",endPositionArray[arrayPointer].Position);magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFromRight",msg:"from right to "+endPositionArray[arrayPointer].Position+" on "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function animationFromTop(){$(animatePage+"[class^=anim-FromTop]").each(function(){var $this=$(this);arrayPointer=jQuery.inArray($this.attr("id"),elementIDArray);var animationObj=splitStandardTransition($this,"FromTop");$this.toggleClass("animate");$($this,".animate").css(userTransition,"all "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css("top",endPositionArray[arrayPointer].Position);magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFromTop",msg:"from top to "+endPositionArray[arrayPointer].Position+" on "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function animationFromBottom(){$(animatePage+"[class^=anim-FromBottom]").each(function(){var $this=$(this);arrayPointer=jQuery.inArray($this.attr("id"),elementIDArray);var animationObj=splitStandardTransition($this,"FromBottom");$this.toggleClass("animate");$($this,".animate").css(userTransition,"all "+animationObj.animTimer+"ms "+animationObj.animEasing+" "+animationObj.animPause+"ms").css("top",endPositionArray[arrayPointer].Position);magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationFromBottom",msg:"from bottom to "+endPositionArray[arrayPointer].Position+" on "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();if(userRenderingEngine!=operaEngine){!function animationCustom(){$(animatePage+"[class^=anim-Custom]").each(function(){var $this=$(this);$this.css({visibility:"visible"});var animationObj=splitCustomTransition($this);$this.toggleClass("animate");$($this,".animate").css(userAnimation,animationObj.animName+" "+animationObj.animTimer+"ms "+animationObj.animPause+"ms "+animationObj.animLoop+" "+animationObj.animDirection);magazineLoader.magazineDebugLog({status:"play animation",namespace:"magazineAnimationRender",functionName:"animationCustom",msg:"call custom animation "+animName+" on "+animatePage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}()}}function removeAnimationController(requestedPage){resetPage="li#page"+requestedPage+" ";!function removeAnimationFadeIn(){$(resetPage+"[class^=anim-FadeIn]").each(function(){var $this=$(this);$($this,".animate").css("opacity","0");$this.toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFadeIn",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function removeAnimationFadeOut(){$(resetPage+"[class^=anim-FadeOut]").each(function(){var $this=$(this);$($this,".animate").css("opacity","1");$($this).toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFadeOut",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function removeAnimationFromLeft(){$(resetPage+"[class^=anim-FromLeft]").each(function(){var $this=$(this);returnWidth=$this.width();$($this,".animate").css({userTransition:"",left:"-"+returnWidth+"px"});$this.toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFadeOut",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function removeAnimationFromRight(){$(resetPage+"[class^=anim-FromRight]").each(function(){var $this=$(this);$($this,".animate").css({userTransition:"",left:magazineWidth+"px"});$this.toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFromRight",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function removeAnimationFromTop(){$(resetPage+"[class^=anim-FromTop]").each(function(){var $this=$(this);returnHeight=$this.height();$this.css({userTransition:"",top:"-"+returnHeight+"px"});$this.toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFromTop",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();!function removeAnimationFromBottom(){$(resetPage+"[class^=anim-FromBottom]").each(function(){var $this=$(this);$this.css({userTransition:"",top:magazineHeight+"px"});$this.removeClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFromBottom",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}();if(userRenderingEngine!=operaEngine){!function removeCustomAnimation(){$(resetPage+"[class^=anim-Custom]").each(function(){var $this=$(this);$this.css({visibility:"hidden"});$($this,".animate").css({userAnimation:""});$this.toggleClass("animate");magazineLoader.magazineDebugLog({status:"reset animation",namespace:"magazineAnimationRender",functionName:"removeAnimationFadeIn",msg:"reset "+resetPage+" "+$this.attr("id"),lineNumber:(new Error).lineNumber})})}()}}return{prepareAnimationController:prepareAnimationController,applyAnimationController:applyAnimationController,removeAnimationController:removeAnimationController,prepareAnimationControllerStatus:prepareAnimationControllerStatus}}();